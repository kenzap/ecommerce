!function(){"use strict";const t=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},e=t=>{let e=new URLSearchParams(window.location.search),a=e.get("sid")?e.get("sid"):"",n=-1==t.indexOf("?")?"?sid="+a:"&sid="+a;return t+n},a=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},n=t=>{let e=t+"=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let n=a[t];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},o={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n("kenzap_api_key"),"Kenzap-Locale":n("locale")?n("locale"):"en","Kenzap-Header":(()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+a()+"/"+n("locale");return e!=n("check")&&(t=0,console.log("refresh")),((t,e,a)=>{let n="";if(a){let t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),n=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+n+";path=/;domain=.kenzap.cloud"})("check",e,5),t})(),"Kenzap-Token":n("kenzap_token"),"Kenzap-Sid":a()},l=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let o=new URLSearchParams;return o.append("cmd","report"),o.append("sid",a()),o.append("token",n("kenzap_token")),o.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:o}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)};var r=function(t){return(""+t).length<2?"0"+t:t},s=function(t,e){e=i(e);var a=parseFloat(e).toFixed(2);switch(t.state.settings.currency_symb_loc){case"left":a=t.state.settings.currency_symb+a;break;case"right":a+=t.state.settings.currency_symb}return a},i=function(t){return t=""==t?0:t,t=parseFloat(t)},c={state:{firstLoad:!0,ajaxQueue:0,modalCont:null,settings:{},charts:{}},init:function(){c.getData()},getData:function(){c.state.firstLoad&&(()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")})(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:o,body:JSON.stringify({query:{locale:{type:"locale",source:["extension"],key:"ecommerce"},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_auto_rate","tax_rate","tax_display"]}}})}).then((function(t){return t.json()})).then((function(e){t(),e.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(e),c.loadHomeStructure(),c.renderPage(e),c.initListeners(),c.initFooter(),c.state.firstLoad=!1):l(e)})).catch((function(t){l(t)}))},renderPage:function(t){(t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let a of t)void 0===a.link?e+=`<li class="breadcrumb-item">${a.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:e("https://dashboard.kenzap.cloud"),text:__("Dashboard")},{link:e("/home/"),text:__("E-commerce")},{text:__("Analytics")}]),c.state.settings=t.settings},initListeners:function(){((t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("click",e,!0),a.addEventListener("click",e,!0)})(".sales-report",c.salesReport)},salesReport:function(t){t.preventDefault();var e=document.querySelector(".modal");c.state.modalCont=new bootstrap.Modal(e),e.querySelector(".modal-dialog").classList.add("modal-fullscreen");var a='\n        <input id="datepicker" class="form-control form-control-sm mt-1 border-0" placeholder="'.concat(__("Today"),'"/>\n        ');e.querySelector(".modal-title").innerHTML=__("Sales report")+" "+a,e.querySelector(".btn-primary").style.display="none",e.querySelector(".btn-secondary").innerHTML=__("Close"),e.querySelector(".modal-body").innerHTML="Loading..";var n=[];new easepick.create({element:document.getElementById("datepicker"),css:["https://cdn.jsdelivr.net/npm/@easepick/bundle@1.1.7/dist/index.css","/assets/css/date_picker.css"],plugins:["RangePlugin","LockPlugin"],RangePlugin:{tooltipNumber:function(t){return t-1},locale:{one:__("day"),other:__("days")}},LockPlugin:{maxDate:new Date,minDays:1,inseparable:!0,filter:function(t,e){if(1===e.length){var a=t.isBefore(e[0])?"[)":"(]";return!e[0].isSame(t,"day")&&t.inArray(n,a)}return t.inArray(n,"[)")}}}).on("select",(function(t){c.salesReportData()}),{}),c.salesReportData(),c.state.modalCont.show()},salesReportData:function(e){var a="",n="",i=document.querySelector("#datepicker").value.split(" - ");if(2==i.length)a=i[0].trim()+"T00:00:00.001Z",n=i[1].trim()+"T23:59:59.001Z";else{var d=new Date;a=d.getUTCFullYear()+"-"+r(d.getUTCMonth()+1)+"-"+r(d.getUTCDate())+"T00:00:00.001Z",n=d.getUTCFullYear()+"-"+r(d.getUTCMonth()+1)+"-"+r(d.getUTCDate())+"T23:59:00.001Z"}console.log(Date.parse(a)+" "+Date.parse(n)),console.log(a+" "+n),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:o,body:JSON.stringify({query:{sales:{type:"find",key:"ecommerce-order",fields:["status","updated","created_ymd"],sum:["total","total_tax","total_with_tax"],count:["total"],term:[{field:"created",relation:">=",type:"numeric",value:Date.parse(a)/1e3|0},{field:"status",relation:"=",type:"string",value:"completed"},{field:"created",relation:"<=",type:"numeric",value:Date.parse(n)/1e3|0}],groupby:[{field:"created_ymd"}],sortby:{field:"created_ymd",order:"DESC"},limit:40,offset:0}}})}).then((function(t){return t.json()})).then((function(e){if(t(),e.success){var a=[["Period","Tax","Total"]],n={total:0,total_tax:0,total_with_tax:0},o={total:__("Total"),total_tax:__("Total tax"),total_with_tax:__("Total with tax")};if(0==e.sales.length)return void(document.querySelector(".modal-body").innerHTML=__("No data to display.."));e.sales.forEach((function(t){t.created_ymd&&(t.total_sum=t.total_sum?t.total_sum:0,t.total_tax_sum=t.total_tax_sum?t.total_tax_sum:0,t.total_with_tax_sum=t.total_with_tax_sum?t.total_with_tax_sum:0,n.total+=t.total_sum,n.total_tax+=t.total_tax_sum,n.total_with_tax+=t.total_with_tax_sum,a.push([t.created_ymd,t.total_tax_sum,t.total_with_tax_sum]))}));var r='<div id="sales-chart" style="min-height:300px"></div>';for(var i in n)r+='\n                    <div class="mb-3 mt-3 order-row" >\n                        <b>'.concat(o[i],"</b> ").concat(s(c,n[i]),"\n                    </div>");document.querySelector(".modal-body").innerHTML=r,google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((function(){var t=google.visualization.arrayToDataTable(a);c.state.charts.sales=new google.visualization.ColumnChart(document.getElementById("sales-chart")),c.state.charts.sales.draw(t,{animation:{duration:1e3,easing:"out"},hAxis:{titleTextStyle:{color:"#1941df"},baselineColor:"#1941df",textStyle:{color:"#212529",fontSize:12,bold:!0}},vAxis:{titleTextStyle:{color:"#1941df"},minValue:0,textStyle:{color:"#212529",fontSize:12,bold:!0}},backgroundColor:{stroke:"#1941df",fill:"transparent",strokeWidth:0},colors:["#dc3545","#1941df","#198754"],bar:{groupWidth:"95%"},legend:{position:"none"}})}))}else l(e)})).catch((function(t){l(t)}))},listeners:{modalSuccessBtn:function(t){c.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},loadHomeStructure:function(){c.state.firstLoad&&(document.querySelector("#contents").innerHTML=function(t){return'\n        <div class="container p-edit">\n            <div class="d-flex justify-content-between bd-highlight mb-3">\n                <nav class="bc" aria-label="breadcrumb"></nav>\n            </div>\n            <div class="row">\n                <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n                    <div class="card border-white shadow-sm p-sm-3 py-3">\n                        <nav class="nav flex-column">\n                            <a class="nav-link active fs-4 sales-report" aria-current="page" href="#">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-shop mb-1 me-3" viewBox="0 0 16 16">\n                            <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zM4 15h3v-5H4v5zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3zm3 0h-2v3h2v-3z"/>\n                            </svg>'.concat(t("Sales report"),'</a>\n\n                            <hr>\n                                               \n                            <a class="nav-link fs-4" href="').concat(e("/orders/"),'">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-tags mb-1 me-3" viewBox="0 0 16 16">\n                            <path d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z"/>\n                            <path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1v5.086z"/>\n                            </svg>').concat(t("Top products"),'</a>\n\n                            <hr>\n                                                \n                            <a class="nav-link fs-4" href="').concat(e("/settings/"),'">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chat-left-dots mb-1 me-3" viewBox="0 0 16 16">\n                            <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n                            <path d="M5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n                            </svg>').concat(t("Customers"),'</a>\n\n                            <hr>\n                                                \n                            <a class="nav-link fs-4 disabled" href="').concat(e("/analytics/"),'" tabindex="-1" aria-disabled="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-graph-up me-3" viewBox="0 0 16 16">\n                            <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0Zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07Z"></path>\n                            </svg>').concat(t("Custom"),'</a>\n                        </nav>\n                    </div>\n                </div>\n            </div>\n   \n            <div class="modal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title"></h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <div class="modal-body">\n\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-primary btn-modal"></button>\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    ')}(__))},initFooter:function(){var t,e;t=__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),e="",document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${t}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${e}</span>\n    </div>`}};c.init()}();
