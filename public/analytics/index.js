!function(){"use strict";function t(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const e=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},a=t=>{let e=new URLSearchParams(window.location.search),a=e.get("sid")?e.get("sid"):"",n=-1==t.indexOf("?")?"?sid="+a:"&sid="+a;return t+n},n=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},o=t=>{let e=t+"=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let n=a[t];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},r={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+o("kenzap_api_key"),"Kenzap-Locale":o("locale")?o("locale"):"en","Kenzap-Header":(()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+n()+"/"+o("locale");return e!=o("check")&&(t=0,console.log("refresh")),((t,e,a)=>{let n="";if(a){let t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),n=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+n+";path=/;domain=.kenzap.cloud"})("check",e,5),t})(),"Kenzap-Token":o("kenzap_token"),"Kenzap-Sid":n()},l=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",n()),a.append("token",o("kenzap_token")),a.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)},s=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("click",e,!0),a.addEventListener("click",e,!0)};var c=function(t){return(""+t).length<2?"0"+t:t},i=function(t,e){switch(e=d(e),e=(Math.round(100*parseFloat(e))/100).toFixed(2),t.state.settings.currency_symb_loc){case"left":e=t.state.settings.currency_symb+e;break;case"right":e+=t.state.settings.currency_symb}return e},d=function(t){return t=t||0,t=parseFloat(t),t=Math.round(100*t)/100},u={state:{firstLoad:!0,ajaxQueue:0,modalCont:null,settings:{},charts:{}},init:function(){u.getData()},getData:function(){u.state.firstLoad&&(()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")})(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:r,body:JSON.stringify({query:{locale:{type:"locale",source:["extension"],key:"ecommerce"},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_auto_rate","tax_rate","tax_display"]}}})}).then((function(t){return t.json()})).then((function(t){e(),t.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(t),u.loadHomeStructure(),u.renderPage(t),u.initListeners(),u.initFooter(),u.state.firstLoad=!1):l(t)})).catch((function(t){l(t)}))},renderPage:function(t){(t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let a of t)void 0===a.link?e+=`<li class="breadcrumb-item">${a.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:a("https://dashboard.kenzap.cloud"),text:__("Dashboard")},{link:a("/home/"),text:__("E-commerce")},{text:__("Analytics")}]),u.state.settings=t.settings},initListeners:function(){s(".sales-report",u.salesReport),s(".products-report",u.productReport)},salesReport:function(t){t.preventDefault();var e=document.querySelector(".modal");u.state.modalCont=new bootstrap.Modal(e),e.querySelector(".modal-dialog").classList.add("modal-fullscreen");var a='\n        <input id="datepicker" class="form-control form-control-sm mt-1 border-0" placeholder="'.concat(__("Today"),'"/>\n        ');e.querySelector(".modal-title").innerHTML=__("Sales report")+" "+a,e.querySelector(".btn-primary").style.display="none",e.querySelector(".btn-secondary").innerHTML=__("Close"),e.querySelector(".modal-body").innerHTML="Loading..";var n=[];new easepick.create({element:document.getElementById("datepicker"),css:["https://cdn.jsdelivr.net/npm/@easepick/bundle@1.1.7/dist/index.css","/assets/css/date_picker.css"],plugins:["RangePlugin","LockPlugin"],RangePlugin:{tooltipNumber:function(t){return t-1},locale:{one:__("day"),other:__("days")}},LockPlugin:{maxDate:new Date,minDays:1,inseparable:!0,filter:function(t,e){if(1===e.length){var a=t.isBefore(e[0])?"[)":"(]";return!e[0].isSame(t,"day")&&t.inArray(n,a)}return t.inArray(n,"[)")}}}).on("select",(function(t){u.salesReportData()}),{}),u.salesReportData(),u.state.modalCont.show()},salesReportData:function(t){var a="",n="",o=document.querySelector("#datepicker").value.split(" - ");if(2==o.length)a=o[0].trim()+"T00:00:00.001Z",n=o[1].trim()+"T23:59:59.001Z";else{var s=new Date;a=s.getUTCFullYear()+"-"+c(s.getUTCMonth()+1)+"-"+c(s.getUTCDate())+"T00:00:00.001Z",n=s.getUTCFullYear()+"-"+c(s.getUTCMonth()+1)+"-"+c(s.getUTCDate())+"T23:59:00.001Z"}console.log(Date.parse(a)+" "+Date.parse(n)),console.log(a+" "+n),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:r,body:JSON.stringify({query:{sales:{type:"find",key:"ecommerce-order",fields:["status","updated","created_ymd"],sum:["total","total_all"],count:["total"],term:[{field:"created",relation:">=",type:"numeric",value:Date.parse(a)/1e3|0},{field:"status",relation:"=",type:"string",value:"completed"},{field:"created",relation:"<=",type:"numeric",value:Date.parse(n)/1e3|0}],groupby:[{field:"created_ymd"}],sortby:{field:"created_ymd",order:"DESC"},limit:40,offset:0}}})}).then((function(t){return t.json()})).then((function(t){if(e(),t.success){var a=[["Period","Tax","Total"]],n={total:0,total_all:0},o={total:__("Subtotal"),total_all:__("Grand Total")};if(0==t.sales.length)return void(document.querySelector(".modal-body").innerHTML=__("No data to display"));t.sales.forEach((function(t){t.created_ymd&&(t.total_sum=t.total_sum?t.total_sum:0,t.total_all_sum=t.total_all_sum?t.total_all_sum:0,n.total+=t.total_sum,n.total_all+=t.total_all_sum,a.push([t.created_ymd,t.total_sum,t.total_all_sum]))}));var r='<div id="sales-chart" style="min-height:300px"></div>';for(var s in n)r+='\n                    <div class="mb-3 mt-3 order-row" >\n                        <b>'.concat(o[s],"</b> ").concat(i(u,n[s]),"\n                    </div>");document.querySelector(".modal-body").innerHTML=r,google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((function(){var t=google.visualization.arrayToDataTable(a);u.state.charts.sales=new google.visualization.ColumnChart(document.getElementById("sales-chart")),u.state.charts.sales.draw(t,{animation:{duration:1e3,easing:"out"},hAxis:{titleTextStyle:{color:"#1941df"},baselineColor:"#1941df",textStyle:{color:"#212529",fontSize:12,bold:!0}},vAxis:{titleTextStyle:{color:"#1941df"},minValue:0,textStyle:{color:"#212529",fontSize:12,bold:!0}},backgroundColor:{stroke:"#1941df",fill:"transparent",strokeWidth:0},colors:["#dc3545","#1941df","#198754"],bar:{groupWidth:"95%"},legend:{position:"none"}})}))}else l(t)})).catch((function(t){l(t)}))},productReport:function(t){t.preventDefault();var e=document.querySelector(".modal");u.state.modalCont=new bootstrap.Modal(e),e.querySelector(".modal-dialog").classList.add("modal-fullscreen");var a='\n        <input id="datepicker" class="form-control form-control-sm mt-1 border-0" placeholder="'.concat(__("Today"),'"/>\n        ');e.querySelector(".modal-title").innerHTML=__("Top products")+" "+a,e.querySelector(".btn-primary").style.display="none",e.querySelector(".btn-secondary").innerHTML=__("Close"),e.querySelector(".modal-body").innerHTML="Loading..";var n=[];new easepick.create({element:document.getElementById("datepicker"),css:["https://cdn.jsdelivr.net/npm/@easepick/bundle@1.1.7/dist/index.css","/assets/css/date_picker.css"],plugins:["RangePlugin","LockPlugin"],RangePlugin:{tooltipNumber:function(t){return t-1},locale:{one:__("day"),other:__("days")}},LockPlugin:{maxDate:new Date,minDays:1,inseparable:!0,filter:function(t,e){if(1===e.length){var a=t.isBefore(e[0])?"[)":"(]";return!e[0].isSame(t,"day")&&t.inArray(n,a)}return t.inArray(n,"[)")}}}).on("select",(function(t){u.productsReportData()}),{}),u.productsReportData(),u.state.modalCont.show()},productsReportData:function(n){var o="",s="",d=document.querySelector("#datepicker").value.split(" - ");if(2==d.length)o=d[0].trim()+"T00:00:00.001Z",s=d[1].trim()+"T23:59:59.001Z";else{var m=new Date;o=m.getUTCFullYear()+"-"+c(m.getUTCMonth()+1)+"-"+c(m.getUTCDate())+"T00:00:00.001Z",s=m.getUTCFullYear()+"-"+c(m.getUTCMonth()+1)+"-"+c(m.getUTCDate())+"T23:59:00.001Z"}console.log(Date.parse(o)+" "+Date.parse(s)),console.log(o+" "+s),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:r,body:JSON.stringify({query:{products:{type:"find",key:"ecommerce-order",fields:["items","updated","created_ymd"],term:[{field:"created",relation:">=",type:"numeric",value:Date.parse(o)/1e3|0},{field:"status",relation:"=",type:"string",value:"completed"},{field:"created",relation:"<=",type:"numeric",value:Date.parse(s)/1e3|0}],sortby:{field:"created",order:"DESC"},limit:1e3,offset:0},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_auto_rate","tax_rate","tax_display"]}}})}).then((function(t){return t.json()})).then((function(n){if(e(),n.success){u.state.settings=n.settings;var o='\n                    <div class="table-responsive">\n                        <table class="table table-hover table-borderless align-middle table-striped table-p-list mb-0" style="min-width: 800px;">\n                            <thead>\n                                <tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th>\n                            </thead>\n                            <tbody>"),r=[],s={qty:0,total:0};n.products.forEach((function(e){Array.isArray(e.items)&&e.items.forEach((function(e){var a;r[e.id]?(r[e.id].qty+=e.qty,r[e.id].total+=e.total):r[e.id]=(t(a={id:e.id,title:e.title,qty:e.qty},"qty",e.qty),t(a,"total",e.total),a)}))}));var c=Object.keys(r).map((function(t){return r[t]}));c.sort((function(t,e){return e.qty-t.qty})),c.forEach((function(t){var e="https://cdn.kenzap.com/loading.png";o+='\n                            <tr class="new-item-row">\n                                <td class="d-none">\n                                    <div class="timgc me-1 me-sm-3">\n                                        <a href="'.concat(a("/product-edit/?id="+t.id),'"><img src="').concat(e,'" data-srcset="').concat(e,'" class="img-fluid rounded" alt="').concat(__("Product placeholder"),'" srcset="').concat(e,'" ></a>\n                                    </div>\n                                </td>\n                                <td class="destt" style="max-width:250px;min-width:150px;">\n                                    <div class="my-1"> \n                                        <a class="text-body" href="').concat(a("/product-edit/?id="+t.id),'" >').concat(t.title,'<i style="color:#9b9b9b;font-size:15px;margin-left:8px;" title="').concat(__("Edit product"),'" class="mdi mdi-pencil menu-icon edit-page"></i></a>\n                                    </div>\n                                </td>\n                                <td class="qty">\n                                    <div class="me-1 me-sm-3">\n                                        ').concat(t.qty,'\n                                    </div>\n                                </td>\n                                <td class="tp">\n                                    ').concat(i(u,t.total),'\n                                </td>\n                                <td class="align-middle text-center"> \n                                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                                </td>\n                            </tr>'),s.qty+=t.qty,s.total+=t.total})),0==c.length&&(o+='<tr><td colspan="4">'.concat(__("No data to display"),"</td></tr>")),c.length>0&&(o+="<tr><td><b>".concat(__("Totals"),"</b></td><td>").concat(s.qty,"</td><td>").concat(i(u,s.total),"</td><td> </td></tr>")),o+="</tbody>\n                    </table>\n                </div>",document.querySelector(".modal-body").innerHTML=o}else l(n)})).catch((function(t){l(t)}))},listeners:{modalSuccessBtn:function(t){u.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},loadHomeStructure:function(){u.state.firstLoad&&(document.querySelector("#contents").innerHTML=function(t){return'\n        <div class="container p-edit">\n            <div class="d-flex justify-content-between bd-highlight mb-3">\n                <nav class="bc" aria-label="breadcrumb"></nav>\n            </div>\n            <div class="row">\n                <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n                    <div class="card border-white shadow-sm p-sm-3 py-3">\n                        <nav class="nav flex-column">\n                            <a class="nav-link active fs-4 sales-report" aria-current="page" href="#">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-shop mb-1 me-3" viewBox="0 0 16 16">\n                            <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zM4 15h3v-5H4v5zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3zm3 0h-2v3h2v-3z"/>\n                            </svg>'.concat(t("Sales report"),'</a>\n\n                            <hr>\n                                               \n                            <a class="nav-link fs-4 products-report" href="#">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-tags mb-1 me-3" viewBox="0 0 16 16">\n                            <path d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z"/>\n                            <path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1v5.086z"/>\n                            </svg>').concat(t("Top products"),'</a>\n\n                            <hr>\n                                                \n                            <a class="nav-link fs-4 disabled" href="').concat(a("/settings/"),'">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chat-left-dots mb-1 me-3" viewBox="0 0 16 16">\n                            <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n                            <path d="M5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n                            </svg>').concat(t("Customers"),'</a>\n\n                            <hr>\n                                                \n                            <a class="nav-link fs-4 disabled" href="').concat(a("/analytics/"),'" tabindex="-1" aria-disabled="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-graph-up me-3" viewBox="0 0 16 16">\n                            <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0Zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07Z"></path>\n                            </svg>').concat(t("Custom"),'</a>\n                        </nav>\n                    </div>\n                </div>\n            </div>\n   \n            <div class="modal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title"></h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <div class="modal-body">\n\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-primary btn-modal"></button>\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    ')}(__))},initFooter:function(){var t,e;t=__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),e="",document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${t}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${e}</span>\n    </div>`}};u.init()}();
