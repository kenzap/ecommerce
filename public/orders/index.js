!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){d=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(d)throw s}}}}const r=()=>{let e=document.querySelector(".loader");e&&(e.style.display="none")},o=e=>{let t=new URLSearchParams(window.location.search),a=t.get("sid")?t.get("sid"):"",n=-1==e.indexOf("?")?"?sid="+a:"&sid="+a;return e+n},s=()=>{let e=new URLSearchParams(window.location.search);return e.get("sid")?e.get("sid"):""},i=e=>{let t=e+"=",a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let n=a[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},d={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+i("kenzap_api_key"),"Kenzap-Locale":i("locale")?i("locale"):"en","Kenzap-Header":(()=>{let e=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,t=window.location.hostname+"/"+s()+"/"+i("locale");return t!=i("check")&&(e=0,console.log("refresh")),((e,t,a)=>{let n="";if(a){let e=new Date;e.setTime(e.getTime()+24*a*60*60*1e3),n=";expires="+e.toUTCString()}document.cookie=e+"="+(escape(t)||"")+n+";path=/;domain=.kenzap.cloud"})("check",t,5),e})(),"Kenzap-Token":i("kenzap_token"),"Kenzap-Sid":s()},c=e=>{if(console.log(e),isNaN(e.code)){let t=e;try{t=JSON.stringify(t)}catch(e){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",s()),a.append("token",i("kenzap_token")),a.append("data",t),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===e.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(e.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(e.reason)},l=(e,t)=>{if(document.querySelector(e))for(let a of document.querySelectorAll(e))a.removeEventListener("click",t,!0),a.addEventListener("click",t,!0)},u=(e,t)=>{if(document.querySelector(e))for(let a of document.querySelectorAll(e))a.removeEventListener("keyup",t,!0),a.addEventListener("keyup",t,!0)},m=e=>{if(!document.querySelector(".toast")){let e='\n        <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",e)}let t=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=e,t.show()};var p=function(e){return(""+e).length<2?"0"+e:e},v=function(e,t){t=y(t);var a=(Math.round(100*parseFloat(t))/100).toFixed(2);switch(e.state.settings.currency_symb_loc){case"left":a=e.state.settings.currency_symb+a;break;case"right":a+=e.state.settings.currency_symb}return a},y=function(e){return e=e||0,e=parseFloat(e)},f=function(e,t,a){var n=(t=parseInt(t))-(a=parseInt(a));if(n<60)return e("moments ago");if(n<3600)return parseInt(n/60)+e(" minutes ago");if(n<86400)return parseInt(n/60/24)+e(" hours ago");var r=new Date(1e3*a),o=[e("Jan"),e("Feb"),e("Mar"),e("Apr"),e("May"),e("Jun"),e("Jul"),e("Aug"),e("Sep"),e("Oct"),e("Nov"),e("Dec")],s=r.getFullYear(),i=o[r.getMonth()],d=r.getDate();return r.getHours(),r.getMinutes(),r.getSeconds(),a=d+" "+i+" "+s},h=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},g={_this:null,renderOrder:function(e,a){var n,r=document.querySelector(".order-modal");e.modalCont=new bootstrap.Modal(r),e.modalOpen=!0;var o=a.currentTarget.dataset.index;history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search+"#editing"),r.addEventListener("hide.bs.modal",(function(e){-1!=window.location.href.indexOf("#editing")&&history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search)})),e.state.orderSingle=void 0===o?{_id:"new",created:1649831099,from:"no name",id:"",idd:"",items:[],kid:"0",name:"no name",note:"",sid:s,status:"new",step:1,table:"1",total:0,updated:1649833845}:e.state.orders[o];var i="";Object.keys(e.state.statuses).forEach((function(t,a){i+='<li><a class="dppi dropdown-item" data-key="'.concat(t,'" href="#">').concat(e.state.statuses[t].text,"</a></li>")}));var d='\n        <div class="st-modal st-opts mb-3 me-1 me-sm-3 dropdown">\n            <a class="btn btn-sm '.concat(e.state.statuses[e.state.orderSingle.status].class,' dropdown-toggle order-form" data-id="status" data-type="key" data-value="').concat(e.state.orderSingle.status,'" href="#" role="button" id="order-status-modal" data-bs-toggle="dropdown" aria-expanded="false" >\n                ').concat(e.state.statuses[e.state.orderSingle.status].text,'\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="order-status-modal">\n                ').concat(i,"\n            </ul>\n        </div>");r.querySelector(".modal-dialog").classList.add("modal-fullscreen"),r.querySelector(".modal-header .modal-title").innerHTML=e.state.orderSingle.from,r.querySelector(".modal-footer .btn-primary").innerHTML="new"==e.state.orderSingle._id?__("Create"):__("Update"),r.querySelector(".btn-primary").dataset.loading=!1,r.querySelector(".modal-footer .btn-secondary").innerHTML=__("Close");var c=d,u=(t(n={id:{l:__("ID")},from:{l:__("From"),e:"text",editable:!0,classList:"order-form"},items:{l:"",e:"items"},fname:{l:__("Name"),e:"text"},lname:{l:__("Surname"),e:"text"},bios:{l:__("Bios"),e:"textarea"},avatar:{l:__("Avatar"),e:"text"},email:{l:__("Email"),e:"text"},countryr:{l:__("Country"),e:"text"},cityr:{l:__("City"),e:"text"},addr1:{l:__("Address 1"),e:"textarea"},addr2:{l:__("Address 2"),e:"textarea"},post:{l:__("Post"),e:"text"},state:{l:__("State"),e:"text"},c1:{l:__("Whatsapp"),e:"text"},c2:{l:__("Messenger"),e:"text"},c3:{l:__("Line"),e:"text"},c4:{l:__("Email"),e:"text"},c5:{l:__("Telegram"),e:"text"}},"email",{l:__("Email"),e:"text"}),t(n,"bio",{l:__("Bio"),e:"text"}),t(n,"y1",{l:__("Name"),e:"text"}),t(n,"y2",{l:__("IBAN"),e:"text"}),t(n,"y3",{l:__("SWIFT"),e:"text"}),t(n,"y4",{l:__("Bank"),e:"text"}),t(n,"y5",{l:__("Bank city"),e:"text"}),t(n,"y6",{l:__("Bank country"),e:"text"}),t(n,"note",{l:__("Note"),e:"textarea"}),t(n,"total",{l:__("Total"),e:"text"}),t(n,"total_tax",{l:__("Tax"),e:"text"}),t(n,"total_with_tax",{l:__("Amount Payable"),e:"text"}),t(n,"s3",{l:__("Link 3"),e:"text"}),t(n,"company",{l:__("Company"),e:"text"}),t(n,"vat",{l:__("Tax ID"),e:"text"}),t(n,"grade",{l:__("Grade"),e:"text"}),t(n,"kenzap_ida",{l:__("Kenzap IDA"),e:"text"}),n);for(var m in u)if(void 0!==e.state.orderSingle[m]){var p=e.state.orderSingle[m],y=u[m].l;switch(m){case"total":case"total_tax":case"total_with_tax":p=v(e,p);default:c+='\n                    <div class="mb-3 mt-3 order-row keyx-'.concat(m," ").concat("_id"==m||"from"==m?"elipsized":"",'" >\n                        <b>').concat(y,"</b>").concat(g.renderField(e,u[m],p,m),"\n                    </div>")}}c+="",r.querySelector(".modal-body").innerHTML='<div class="modal-body-cont">'+c+"</div>",e.modalCont.show(),g.tableOrderItemListeners(),g.suggestOrderItem(e),r.querySelector(".edit-item").addEventListener("blur",(function(e){setTimeout((function(){document.querySelector(".s-list").dataset.toggle=!1}),500)})),g.addOrderItem(e),"new"==e.state.orderSingle._id&&g.refreshTotals(),"new"==e.state.orderSingle._id&&setTimeout((function(){document.querySelector(".edit-item").focus()}),300),e.listeners.modalSuccessBtnFunc=function(t){t.preventDefault(),e.updateOrder(o,e.state.orderSingle._id)},l(".st-modal li a",(function(t){t.preventDefault();var a=document.querySelector("#order-status-modal");a.innerHTML=e.state.statuses[t.currentTarget.dataset.key].text,a.dataset.value=t.currentTarget.dataset.key;Object.keys(e.state.statuses).forEach((function(t){e.state.statuses[t].class.split(" ").forEach((function(e){a.classList.remove(e)}))})),e.state.statuses[t.currentTarget.dataset.key].class.split(" ").forEach((function(e){a.classList.add(e)}))}))},newOrder:function(e){g._this=e,l(".add-order",(function(t){g.renderOrder(e,t)}))},viewOrder:function(e){g._this=e,l(".view-order",(function(t){g.renderOrder(e,t)}))},renderField:function(e,t,a,n){var r="";switch(t.e){case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(t.classList?t.classList:"",' ms-2 d-inline-block" ').concat(t.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var o in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=g.structOrderItemTable(e,o,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3">\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(t.classList?t.classList:"",' ms-2 d-inline-block" ').concat(t.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},itemOptions:function(e){return'\n\n        <div class="dropdown text-center">\n            <a  href="#" role="button" id="order-item-options" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical order-item-options" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="order-item-options" >\n                <li><a class="oio dropdown-item edit-item-note" data-key="edit-item-note" href="#">'.concat(__("Add note"),'</a></li>\n                <li><a class="oio dropdown-item d-none" data-key="edit-item-variation" href="#">').concat(__("Add variation"),'</a></li>\n                <li><a class="oio dropdown-ite d-none" data-key="edit-item-price" href="#">').concat(__("Adjust price"),'</a></li>\n                <li><a class="oio dropdown-item text-danger remove-item" data-key="remove-item" href="#">').concat(__("Remove"),"</a></li>\n            </ul>\n        </div>\n    ")},structOrderItemTable:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o="",s="";for(var i in a[t].variations){var d="";for(var c in a[t].variations[i].list)d+=a[t].variations[i].list[c].title+" ";o+="<div><b>"+a[t].variations[i].title+"</b> <span>"+d+"</span></div> ",void 0!==a[t].variations[i].note&&a[t].variations[i].note.length>0&&(o+="<div><b>"+__("Note")+"</b> "+a[t].variations[i].note+"</div> ")}return s+='<tr class="order-item-row-active" data-x="'+t+'" data-id="'+a[t].id+'" data-vars="'+h(JSON.stringify(a[t].variations))+'">',s+='<td ><div class="item-title" contenteditable="false" data-value="'+a[t].title+'" data-sdesc="'+(a[t].sdesc?a[t].sdesc:"")+'">'+a[t].title+'</div><div class="item-note text-muted mb-1 '+(0!=a[t].note.length&&"<br>"!=a[t].note||n?"":"d-none")+'" contenteditable="true" data-value="'+a[t].note+'">'+a[t].note+'</div><div class="vars border-primary item-variations my-1 ps-2 text-secondary" data-value="">'+o+'</div></td><td class="qty"><div class="me-1 me-sm-3 item-qty" data-value="'+a[t].qty+'">'+a[t].qty+'</div></td><td class="tp"><div class="me-1 me-sm-3 item-pricef" data-price="'+a[t].price+'" data-value="'+a[t].priceF+'" >'+v(e,a[t].priceF)+'</div><td class="'+(r?"":"d-none")+'">'+g.itemOptions(a[t])+"</td></td>",s+="</tr>"},suggestOrderItem:function(t){u(".edit-item",(function(a){var n=a.keyCode||a.charCode;if(!(n>=34&&n<=45)){var o,s,i=a.currentTarget.value;if(0!=i.length&&a.currentTarget===document.activeElement)fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{products:{type:"find",key:"ecommerce-product",fields:["_id","id","img","status","variations","price","title"],limit:t.state.slist,term:[{type:"string",field:"status",relation:"=",value:"1"}],offset:i.length>0?0:(o=new URLSearchParams(window.location.search),s=o.get("page")?o.get("page"):1,parseInt(s)*t.state.slist-t.state.slist),search:{field:"title",s:i},sortby:{field:"title",order:"DESC"}}}})}).then((function(e){return e.json()})).then((function(a){if(r(),console.log(a),a.success){t.state.productsSuggestions=a.products;var n="";a.products.forEach((function(e,t){n+='<li class="s-list-item py-1" data-id="'.concat(e._id,'" data-title="').concat(e.title,'" data-index="').concat(t,'"  data-display="true" data-highlight="false">').concat(e.title,"</li>")})),document.querySelector(".s-list").innerHTML=n,document.querySelector(".s-list").dataset.toggle=!0,l(".s-list-item",(function(a){var n=a.currentTarget.dataset.index;document.querySelector(".edit-item").dataset.index=n,document.querySelector(".edit-item").dataset.id=t.state.productsSuggestions[n]._id,document.querySelector(".edit-item").value=t.state.productsSuggestions[n].title,document.querySelector(".edit-qty").value=1,document.querySelector(".edit-qty").dataset.price=t.state.productsSuggestions[n].price,document.querySelector(".edit-tp").value=t.state.productsSuggestions[n].price,document.querySelector(".edit-tp").dataset.price=t.state.productsSuggestions[n].price,document.querySelector(".s-list").dataset.toggle=!1;document.querySelector(".edit-qty").addEventListener("keypress",(function(e){if(8!=e.which&&isNaN(String.fromCharCode(e.which)))return e.preventDefault(),!1})),document.querySelector(".edit-qty").addEventListener("keydown",(function(e){setTimeout((function(){var e;e=parseFloat(document.querySelector(".edit-qty").value)*parseFloat(document.querySelector(".edit-qty").dataset.price),isNaN(e)&&(e=""),document.querySelector(".edit-tp").value=e}),300)})),document.querySelector(".edit-tp").addEventListener("keypress",(function(e){if(8!=e.which&&46!=e.which&&isNaN(String.fromCharCode(e.which)))return e.preventDefault(),!1})),document.querySelector(".edit-qty").focus(),document.querySelector(".edit-qty").select(),document.querySelector(".item-vars-input").innerHTML=function(t,a){var n="";if(e("undefined"!==a.variations))for(var r in a.variations){var o="";for(var s in"checkbox"==a.variations[r].type&&(o="check"),"radio"==a.variations[r].type&&(o="radio"),n+="        <b>"+__(a.variations[r].title)+("1"==a.variations[r].required?' <span class="tag">'+__("required")+"</span>":"")+'</b>        <div class="kp-'+o+'" >',a.variations[r].data)switch(a.variations[r].data[s].price=y(a.variations[r].data[s].price),o){case"check":n+='                    <label>                        <input type="checkbox" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" data-index="'+s+'" data-title="'+a.variations[r].data[s].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[s].price+'" >                        <div class="checkbox">                            <svg width="20px" height="20px" viewBox="0 0 20 20">                                <path d="M3,1 L17,1 L17,1 C18.1045695,1 19,1.8954305 19,3 L19,17 L19,17 C19,18.1045695 18.1045695,19 17,19 L3,19 L3,19 C1.8954305,19 1,18.1045695 1,17 L1,3 L1,3 C1,1.8954305 1.8954305,1 3,1 Z"></path>                                <polyline points="4 11 8 15 16 6"></polyline>                            </svg>                        </div>                        <span>'+__(a.variations[r].data[s].title)+'</span>                        <div class="price">+ '+v(t,a.variations[r].data[s].price)+"</div>                    </label>";break;case"radio":n+='                    <label>                        <input type="radio" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" name="radio'+r+'" data-index="'+s+'" data-title="'+a.variations[r].data[s].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[s].price+'"  />                        <span>'+__(a.variations[r].data[s].title)+'</span>                        <div class="price">+ '+v(t,a.variations[r].data[s].price)+"</div>                    </label>"}n+="</div>"}return n}(t,t.state.productsSuggestions[n])}))}else c(a)})).catch((function(e){console.log(e),c(e)}));else document.querySelector(".s-list").dataset.toggle=!1}}))},tableOrderItemListeners:function(e){l(".edit-item-note",(function(e){e.preventDefault();var t=e.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector(".item-note");console.log(t),t.classList.remove("d-none"),t.focus()})),l(".remove-item",(function(e){e.preventDefault(),e.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.remove(),g.refreshTotals()}))},refreshTotals:function(){document.querySelector(".order-total")&&document.querySelector(".order-total").remove(),document.querySelector(".keyx-total")&&document.querySelector(".keyx-total").remove(),document.querySelector(".keyx-total_tax")&&document.querySelector(".keyx-total_tax").remove(),document.querySelector(".keyx-total_with_tax")&&document.querySelector(".keyx-total_with_tax").remove();var e,t="",a={total:{title:__("Total"),amount:0},total_tax:{title:__("Tax"),amount:0},total_with_tax:{title:__("Paid"),amount:0}},r=n(document.querySelectorAll(".item-pricef"));try{for(r.s();!(e=r.n()).done;){var o=e.value,s=.09*y(o.dataset.value);a.total.amount+=y(o.dataset.value),a.total_tax.amount+=s,a.total_with_tax.amount+=y(o.dataset.value)+s}}catch(e){r.e(e)}finally{r.f()}for(var i in a){var d=a[i].title;"total_tax"==i&&(d=g._this.state.settings.tax_display+" ("+g._this.state.settings.tax_rate+"%):"),t+='\n        <div class="mb-3 mt-3 order-row elipsized keyx-'.concat(i,'">\n            <b>').concat(d,'</b><div class="order-form ms-2 d-inline-block" data-id="').concat(i,'" data-type="key-number" data-value="').concat(a[i].amount,'">').concat(v(g._this,a[i].amount),"</div>\n        </div>")}t='<div class="order-total">'.concat(t,"</div>"),document.querySelector(".modal-body-cont").insertAdjacentHTML("beforeend",t)},addOrderItem:function(e){l(".add-item",(function(t){var a=[],r={};r.id=document.querySelector(".edit-item").dataset.id,r.title=document.querySelector(".edit-item").value,r.priceF=parseFloat(document.querySelector(".edit-tp").value),r.price=parseInt(document.querySelector(".edit-tp").dataset.price),r.qty=parseInt(document.querySelector(".edit-qty").value),r.note="",r.variations=[];var o,s=0,i=n(document.querySelectorAll(".item-vars-input input"));try{for(i.s();!(o=i.n()).done;){var d=o.value,c=s;d.checked&&(r.variations[c]||(r.variations[c]={}),r.variations[c].list||(r.variations[c].list={}),r.variations[c].title||(r.variations[c].title=d.dataset.titlev),r.variations[c].list["_"+d.dataset.index]={title:d.dataset.title,price:parseFloat(d.dataset.price)},r.priceF+=r.qty*parseFloat(d.dataset.price),s+=1)}}catch(e){i.e(e)}finally{i.f()}if(r.title.length<2)alert(__("Incorrect product data"));else{a.push(r);var l=g.structOrderItemTable(e,0,a,!0);document.querySelector(".new-item-row").insertAdjacentHTML("beforebegin",l),g.tableOrderItemListeners(),g.refreshTotals(),document.querySelector(".edit-item").value="",document.querySelector(".edit-tp").value="",document.querySelector(".edit-qty").value="",document.querySelector(".item-vars-input").innerHTML="",setTimeout((function(){document.querySelector(".edit-item").focus()}),300)}}))}},b={viewOrder:function(e){b._this=e,l(".print-order",(function(t){b.renderOrder(e,t)}))},renderOrder:function(e,t){t.preventDefault();var a=new Date,n=t.currentTarget.dataset.index;e.state.orderSingle=e.state.orders[n];var r=e.state.orders[n];r.entity="Fu Zhen Seafood";var o={};o.print=e.state.settings.receipt_template,o.print=o.print.replace(/{{order_id_short}}/g,r.id.substr(0,5)),o.print=o.print.replace(/{{date_time}}/g,a.toLocaleString([],{dateStyle:"medium",timeStyle:"short"}));var s="";for(var i in r.items)for(var d in s+="[L]<b>".concat(r.items[i].qty," X ").concat(r.items[i].title,"</b>[R]").concat(v(e,r.items[i].priceF),"\n"),r.items[i].variations){for(var c in s+="[L]| ".concat(r.items[i].variations[d].title,":"),r.items[i].variations[d].list)s+=" ".concat(r.items[i].variations[d].list[c].title,",");s.endsWith(",")&&(s=s.substring(0,s.length-1)+"\n")}s.endsWith("\n")&&(s=s.substring(0,s.length-2)),o.print=o.print.replace(/{{order_items}}/g,s);var l=0==r.note.length||"<br>"==r.note?"":r.note;return l.length>0&&(o.print=o.print.replace(/{{order_note}}/g,"[C]================================\n"+l+"\n[C]================================\n")),o.print=o.print.replace(/{{total}}/g,v(e,r.total)),o.print=o.print.replace(/{{total_tax}}/g,v(e,r.total_tax)),o.print=o.print.replace(/{{total_with_tax}}/g,v(e,r.total_with_tax)),o.debug=!1,console.log("kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(o))),m(__("Printing j")),location.href="kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(o)),!1}},_={state:{firstLoad:!0,firstTouch:!0,modalCont:null,modalOpen:!1,playSoundNow:!1,newOrderCount:0,orderIDs:[],orders:[],settings:{},orderSingle:[],playTitleTimer:null,refreshTimer:null,statuses:[],audio:new Audio("https://kenzap.com/static/swiftly.mp3"),limit:50,slistLimit:10,productsSuggestions:[]},init:function(){_.getData()},getData:function(){_.state.firstLoad&&(()=>{let e=document.querySelector(".loader");e&&(e.style.display="block")})();var e=document.querySelector(".search-input")?document.querySelector(".search-input").value:"",t=document.querySelector("#order-status")?document.querySelector("#order-status").dataset.value:"";fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar"],token:i("kenzap_token")},locale:{type:"locale",source:["extension"],key:"ecommerce"},orders:{type:"find",key:"ecommerce-order",fields:"*",term:""!=t?"status='"+t+"'":"",limit:_.state.limit,search:{field:"from",s:e},sortby:{field:"created",order:"DESC"}},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_auto_rate","tax_rate","tax_display","receipt_template"]}}})}).then((function(e){return e.json()})).then((function(e){r(),e.success?((e=>{if(e.header&&localStorage.setItem("header",e.header),!document.querySelector("#k-script")){let e=document.createElement("div");e.innerHTML=localStorage.getItem("header"),e=e.firstChild,document.body.prepend(e),Function(document.querySelector("#k-script").innerHTML).call("test")}e.locale&&window.i18n.init(e.locale)})(e),_.loadPageStructure(),_.renderPage(e),_.initListeners(),_.initFooter(),_.state.firstLoad=!1):c(e)})).catch((function(e){c(e)}))},authUser:function(e){e.user&&e.user.success},loadPageStructure:function(){_.state.firstLoad&&(document.querySelector("#contents").innerHTML=function(e){return'\n      <div class="container ec-orders">\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n            <nav class="bc" aria-label="breadcrumb"></nav>\n            <button class="btn btn-primary add-order btn-add mt-3 mb-1 mt-md-0 mb-md-0" type="button">'.concat(e("New order"),'</button>\n        </div>\n        <div class="row">\n          <div class="col-md-12 page-title">\n            <div class="st-opts st-table mb-3 dropdown">\n                <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="order-status" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                  ').concat(e("All"),'\n                </a>\n                <ul class="dropdown-menu" aria-labelledby="order-status">\n                  <li><a class="dppi dropdown-item" data-key="" href="#" >').concat(e("All"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="new" href="#" >').concat(e("New"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="paid" href="#" >').concat(e("Paid"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="processing" href="#" >').concat(e("Processing"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="completed" href="#" >').concat(e("Completed"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="canceled" href="#" >').concat(e("Canceled"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="failed" href="#" >').concat(e("Failed"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="refunded" href="#" >').concat(e("Refunded"),'</a></li>\n                </ul>\n            </div>\n            <div class="st-opts" >\n              <div class="input-group-sm mb-0 justify-content-start mb-3 mb-sm-0" >\n                <input id="usearch" type="text" class="inp form-control search-input" autocomplete="off" placeholder="').concat(e("Search order"),'">\n              </div>\n              \x3c!-- <a id="viewSum" href="#" style="margin-left:16px;">view summary</a> --\x3e\n            </div>\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n            <div class="card border-white shadow-sm border-0">\n              <div class="card-body p-0">\n \n                <div class="table-responsive">\n                  <table class="table table-hover table-borderless align-middle table-striped table-p-list mb-0">\n                    <thead>\n                      <tr>\n                        <th><span class="ps-1">').concat(e("From"),'</span></th>\n                        <th class="d-none d-sm-table-cell">').concat(e("Status"),"</th>\n                        <th>").concat(e("Total"),'</th>\n                        <th class="d-none d-sm-table-cell">').concat(e("Time"),'</th>\n                        <th></th>\n                      </tr>\n                    </thead>\n                    <tbody class="list">\n\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="modal order-modal" tabindex="-1" data-backdrop="static" data-keyboard="false">\n        <div class="modal-dialog ">\n          <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title"></h5>\n                <button type="button" class="btn-close align-self-start-remove" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body">\n              \n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-primary"></button>\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n              </div>\n          </div>\n        </div>\n      </div>\n\n    ')}(__))},renderPage:function(e){if(_.state.firstLoad&&((e=>{let t='<ol class="breadcrumb mt-2 mb-0">';for(let a of e)void 0===a.link?t+=`<li class="breadcrumb-item">${a.text}</li>`:t+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;t+="</ol>",document.querySelector(".bc").innerHTML=t})([{link:o("https://dashboard.kenzap.cloud"),text:__("Dashboard")},{link:o("/"),text:__("E-commerce")},{text:__("Orders")}]),_.state.statuses={new:{text:__("New"),class:"btn-warning text-dark fw-light"},paid:{text:__("Paid"),class:"btn-primary fw-light"},processing:{text:__("Processing"),class:"btn-primary fw-light"},completed:{text:__("Completed"),class:"btn-success fw-light"},canceled:{text:__("Canceled"),class:"btn-secondary fw-light"},failed:{text:__("Failed"),class:"btn-danger fw-light"},refunded:{text:__("Refunded"),class:"btn-danger fw-light"}}),_.state.orders=e.orders,_.state.settings=e.settings,0!=e.orders.length){var t=[];_.state.newOrderCount=[];var a="",n=0;for(var r in e.orders){t.push(e.orders[r]._id),void 0===e.orders[r].status&&(e.orders[r].status="new"),"new"==e.orders[r].status&&n++;var s=_.state.orderIDs.includes(e.orders[r]._id)||_.state.firstLoad?"":"new";a+='\n            <tr class="'.concat(s,'">\n              <td class="details">\n                <div class="ps-1 view-order" data-id="').concat(e.orders[r]._id,'" data-index="').concat(r,'">\n                  <b class="">').concat(e.orders[r].id,"</b> ").concat(e.orders[r].from,'\n                  <div class=" elipsized fst-italic">').concat(e.orders[r].note?e.orders[r].note:"",'</div>\n                  <div class=" d-sm-none"> <span class="me-2">').concat(_.getStatus(e.orders[r].status),'</span> <span class="text-muted">').concat(f(__,e.meta.time,e.orders[r].created),'</span> </div>\n                </div>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span class="fs-12">').concat(_.getStatus(e.orders[r].status),'</span>\n              </td>\n              <td>\n                <span style="font-size:18px;">').concat(v(_,e.orders[r].total),'</span>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span style="font-size:18px;">').concat(f(__,e.meta.time,e.orders[r].created),'</span>\n              </td>\n              <td class="last">\n                <a href="#" data-id="').concat(e.orders[r]._id,'" data-index="').concat(r,'" class="view-order text-success d-none me-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>\n                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>\n                </svg></a>\n                <a href="kenzapprint://kenzapprint.app?data=').concat(encodeURIComponent(JSON.stringify({print:'[C]<u><font size="big">ORDER{{order_id_short}}</font></u>\n[C]Fu Zhen Seafood\n[C]<u type=double>{{date_time}}</u>\n[C]\n[C]================================" \n[L]\n[L]<b>BEAUTIFUL SHIRT</b>[R]9.99€\n[L]  + Size : S\n[L]\n[L]<b>AWESOME HAT</b>[R]24.99€\n[L]  + Size : 57/58\n[L]\n[C]--------------------------------\n[R]TOTAL PRICE :[R]34.98€\n[R]TAX :[R]4.23€'})),'" data-id="').concat(e.orders[r]._id,'" data-index="').concat(r,'" class="print-order text-success me-2">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>\n                </svg></a>\n                <a href="#" data-id="').concat(e.orders[r]._id,'" data-index="').concat(r,'" class="remove-order text-danger me-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n                </svg></a>\n              </td>\n            </tr>')}_.state.playSoundNow=n>0,_.state.orderIDs=t,document.querySelector(".table tbody").innerHTML=a}else document.querySelector(".table tbody").innerHTML='<tr><td colspan="5">'.concat(__("No orders to display."),"</td></tr>")},getStatus:function(e){return'<div class="badge '.concat(_.state.statuses[e].class,'">').concat(_.state.statuses[e].text,"</div>")},playSound:function(){console.log("playSound"),_.state.audio.play()},playTitle:function(e){},initListeners:function(){g.viewOrder(_),l(".remove-order",_.listeners.removeOrder),b.viewOrder(_),l(".st-table li a",_.listeners.changeStatus),_.state.firstLoad&&(g.newOrder(_),l(".modal .btn-primary",_.listeners.modalSuccessBtn),u(".search-input",_.listeners.searchOrders),document.body.addEventListener("touchstart",(function(){_.state.firstTouch?(_.state.audio.play(),_.state.audio.pause(),_.state.audio.currentTime=0,_.state.firstTouch=!1):(_.state.playTitleTimer&&clearInterval(_.state.playTitleTimer),_.state.playTitleTimer=setInterval((function(){_.state.playSoundNow&&_.playSound()}),6500))}),!1),window.addEventListener("hashchange",(function(e){if(_.modalCont)return e.preventDefault(),_.modalOpen=!1,_.modalCont.hide(),!1})))},listeners:{newOrder:function(e){},changeStatus:function(e){e.preventDefault();var t=document.querySelector("#order-status");""==e.currentTarget.dataset.key?(t.innerHTML=__("All"),t.dataset.value=""):(t.innerHTML=_.state.statuses[e.currentTarget.dataset.key].text,t.dataset.value=e.currentTarget.dataset.key);Object.keys(_.state.statuses).forEach((function(e){_.state.statuses[e].class.split(" ").forEach((function(e){t.classList.remove(e)}))})),""==e.currentTarget.dataset.key?t.classList.add("btn-primary"):_.state.statuses[e.currentTarget.dataset.key].class.split(" ").forEach((function(e){t.classList.add(e)})),_.getData()},removeOrder:function(e){e.preventDefault(),confirm(__("Completely remove this order?"))&&fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{product:{type:"delete",key:"ecommerce-order",id:e.currentTarget.dataset.id,sid:s()}}})}).then((function(e){return e.json()})).then((function(e){e.success?_.getData():c(e)})).catch((function(e){c(e)}))},searchOrders:function(e){e.preventDefault(),_.getData()},modalSuccessBtn:function(e){_.listeners.modalSuccessBtnFunc(e)},modalSuccessBtnFunc:null},updateOrder:function(e,t){var a=document.querySelector(".modal");if("true"!==a.querySelector(".btn-primary").dataset.loading){a.querySelector(".btn-primary").dataset.loading=!0,a.querySelector(".btn-primary").innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+__("Loading..");var r,o={},i=n(document.querySelectorAll(".order-form"));try{for(i.s();!(r=i.n()).done;){var l=r.value;switch(l.dataset.type){case"key":o[l.dataset.id]=l.dataset.value;break;case"key-number":o[l.dataset.id]=y(l.dataset.value);break;case"items":o.items=[];var u,v=n(document.querySelectorAll(".order-item-row-active"));try{for(v.s();!(u=v.n()).done;){var f=u.value,h=JSON.parse(f.dataset.vars.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&"));o.items.push({id:f.dataset.id,qty:parseInt(f.querySelector(".item-qty").dataset.value),note:f.querySelector(".item-note").innerHTML,type:"new",index:"0",price:parseFloat(f.querySelector(".item-pricef").dataset.price),sdesc:f.querySelector(".item-title").dataset.sdesc,title:f.querySelector(".item-title").dataset.value,priceF:parseFloat(f.querySelector(".item-pricef").dataset.value),variations:"new"==t?[]:h||[]})}}catch(e){v.e(e)}finally{v.f()}break;case"text":o[l.dataset.id]=l.innerHTML;break;case"email":case"emails":case"select":case"textarea":o[l.id]=l.value;break;case"radio":o[l.id]=l.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector("input:checked").value}}}catch(e){i.e(e)}finally{i.f()}var g=new Date;o.created_ymd=g.getUTCFullYear()+""+p(g.getUTCMonth()+1)+p(g.getUTCDate()),o.created_ym=g.getUTCFullYear()+""+p(g.getUTCMonth()+1),o.created_y=g.getUTCFullYear()+"","new"==t?(o.name=o.from,fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{settings:{type:"get",key:"ecommerce-settings",fields:["last_order_id"]}}})}).then((function(e){return e.json()})).then((function(e){e.success?(o.id=y(e.settings.last_order_id)+1,console.log("number: "+o.id),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{order:{type:"create",key:"ecommerce-order",sid:s(),data:o}}})}).then((function(e){return e.json()})).then((function(e){e.success?(_.modalCont.hide(),m(__("Order created")),_.getData()):c(e)})).catch((function(e){c(e)})),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{settings:{type:"set",key:"ecommerce-settings",sid:s(),data:{last_order_id:o.id}}}})}).then((function(e){return e.json()})).then((function(e){e.success||c(e)})).catch((function(e){c(e)}))):c(e)})).catch((function(e){c(e)}))):fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{order:{type:"update",key:"ecommerce-order",sid:s(),id:t,data:o}}})}).then((function(e){return e.json()})).then((function(e){e.success?(_.modalCont.hide(),m(__("Order updated")),_.getData()):c(e)})).catch((function(e){c(e)}))}},initFooter:function(){var e,t;e=__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),t="",document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${e}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${t}</span>\n    </div>`}};_.init()}();
