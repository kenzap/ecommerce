!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function a(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function s(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=n(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,d=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){d=!0,o=t},f:function(){try{i||null==a.return||a.return()}finally{if(d)throw o}}}}const o=(t,...e)=>0===(t=String(t)).length?"":(t=((t,...e)=>{let a=(t,e)=>(e.forEach(((e,a)=>{t=t.replace("%"+(a+1)+"$",e)})),t);return void 0===window.i18n||void 0===window.i18n.state.locale.values[t]?a(t,e):a(window.i18n.state.locale.values[t],e)})(t,...e),t.replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[t])))),i=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},d=t=>{let e=new URLSearchParams(window.location.search),a=e.get("sid")?e.get("sid"):"",n=-1==t.indexOf("?")?"?sid="+a:"&sid="+a;return t+n},c=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},l=t=>{let e=t+"=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let n=a[t];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},u={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l("kenzap_api_key"),"Kenzap-Locale":l("locale")?l("locale"):"en","Kenzap-Header":(()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+c()+"/"+l("locale");return e!=l("check")&&(t=0,console.log("refresh")),((t,e,a)=>{let n="";if(a){let t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),n=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+n+";path=/;domain=.kenzap.cloud"})("check",e,5),t})(),"Kenzap-Token":l("kenzap_token"),"Kenzap-Sid":c()},p=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",c()),a.append("token",l("kenzap_token")),a.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)},m=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("click",e,!0),a.addEventListener("click",e,!0)},v=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("keyup",e,!0),a.addEventListener("keyup",e,!0)},h=t=>{let e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)},f=t=>{if(!document.querySelector(".toast")){let t='\n        <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",t)}let e=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=t,e.show()};var y=function(t){return(""+t).length<2?"0"+t:t},g=function(t,e){switch(e=b(e),e=(Math.round(100*parseFloat(e))/100).toFixed(2),t.state.settings.currency_symb_loc){case"left":e=t.state.settings.currency_symb+e;break;case"right":e+=t.state.settings.currency_symb}return e},b=function(t){return t=t||0,t=parseFloat(t),t=Math.round(100*t)/100},_=function(t,e){document.querySelector(t)&&document.querySelector(t).addEventListener("keypress",(function(a){if(!e.includes(a.which)&&isNaN(String.fromCharCode(a.which))||32==a.which||document.querySelector(t).value.includes(String.fromCharCode(a.which))&&e.includes(a.which))return a.preventDefault(),!1}))},S=function(t,e,a){var n=(e=parseInt(e))-(a=parseInt(a));if(n<60)return t("moments ago");if(n<3600)return parseInt(n/60)+" "+t("minutes ago");if(n<86400)return parseInt(n/60/60)+" "+t("hours ago");var r=new Date(1e3*a),s=[t("Jan"),t("Feb"),t("Mar"),t("Apr"),t("May"),t("Jun"),t("Jul"),t("Aug"),t("Sep"),t("Oct"),t("Nov"),t("Dec")],o=r.getFullYear(),i=s[r.getMonth()],d=r.getDate();return r.getHours(),r.getMinutes(),r.getSeconds(),a=d+" "+i+" "+o},w=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},x=function(t){return t=(t=(t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&#39;/g,"'")).replace(/&amp;/g,"&")},q=function(t,e){t.state.playSound.n=0,t.state.playSound.timer&&clearInterval(t.state.playSound.timer),t.state.playSound.allowed&&t.state.playSound.audio.play();try{t.state.playSound.allowed&&((a=navigator.userAgent.toLowerCase()).match(/iphone/i)||a.match(/ipod/i)||a.match(/ipad/i)||a.match(/android/i))&&window.navigator.vibrate(200)}catch(t){}var a;1!=e&&(t.state.playSound.timer=setInterval((function(){t.state.playSound.allowed&&(t.state.playSound.audio.play(),t.state.playSound.n>e&&clearInterval(t.state.playSound.timer),t.state.playSound.n+=1)}),5e3))},k=function(t,e){var a="",n=!1;if(e.forEach((function(e){t.state.playSound.nids.includes(e._id)||(t.state.playSound.nids.push(e._id),n=!0),document.querySelector('#contents .container [data-id="'+e._id+'"]')||(a+='\n\n            <div class="alert alert-'.concat(e.color,' alert-dismissible fade show" role="alert" data-id="').concat(e._id,'">\n                <div class="d-flex align-items-center">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-square flex-shrink-0 me-2" viewBox="0 0 16 16">\n                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n                        <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>\n                    </svg>\n                    <div>\n                    ').concat(e.msg,'\n                    </div>\n                </div>\n                <button type="button" class="btn-close btn-dismiss-notify" data-bs-dismiss="alert" aria-label="Close" data-id="').concat(e._id,'"></button>\n            </div>'))})),n&&(q(t,1),t.getData()),document.querySelector("#contents .container")&&document.querySelector("#contents .container").insertAdjacentHTML("afterbegin",a),function(t,e){if(document.querySelector(t)){var a,n=s(document.querySelectorAll(t));try{for(n.s();!(a=n.n()).done;){var r=a.value;r.removeEventListener("click",e,!0),r.addEventListener("click",e,!0)}}catch(t){n.e(t)}finally{n.f()}}}(".btn-dismiss-notify",(function(t){fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:u,body:JSON.stringify({query:{updates:{type:"dismiss",id:t.currentTarget.dataset.id}}})}).then((function(t){return t.json()})).then((function(t){t.success})).catch((function(t){}))})),document.querySelector(".order-details")){var r,o=s(document.querySelectorAll(".order-details"));try{for(o.s();!(r=o.n()).done;){var i=r.value;if("1"==i.dataset.assigned)return;i.dataset.assigned=1,i.addEventListener("click",(function(t){var e=document.querySelector(".view-order[data-id='"+t.currentTarget.dataset.id+"']");h(e)}),!0)}}catch(t){o.e(t)}finally{o.f()}}},L=function(t,e,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s={},o={},i=new Date;if("test"==e?s={_id:"test",id:"test",created:1649831099,from:"dine-in",idd:"",items:[{cats:[],id:"02de5fc62938ba0b031b4e80e962bac15a7285d8",index:"0",note:"",price:45,qty:2,sdesc:"Salted Egg Crab",title:"咸蛋螃蟹",total:45,type:"new",variations:[]},{cats:[],id:"69ae96cfb7b25c358dd07560fc55e7d83cae2eb7",index:"0",note:"",price:45,qty:1,sdesc:"Kam Heong Crab",title:"金香螃蟹",total:45,type:"new",variations:[]},{cats:["Other"],id:"a678f2b21a3a3f7e97b6707d8223f32d17ecbefa",index:"0",note:"",price:10,qty:12,sdesc:"",title:"鱼鳔羮",total:10,type:"new",variations:[]},{cats:["Other"],id:"a678f2b21a3a3f7e97b6707d8223f32d17ecbefa",index:"0",note:"",price:25,qty:1,sdesc:"",title:"螃蟹米粉汤 (粗/幼米粉）",total:25,type:"new",variations:[]},{cats:["Other"],id:"a678f2b21a3a3f7e97b6707d8223f32d17ecbefa",index:"0",note:"",price:4,qty:1,sdesc:"",title:"Fied Chicken Noodles",total:4,type:"new",variations:[]}],kid:"0",name:"dine-in",note:"",sid:c,status:"new",price:{discount_percent:10,discount_total:11.105,discount_value:0,fee_total:0,grand_total:99.95,payment_method:"Cash",tax_percent:0,tax_total:0,total:111.05},step:1,table:"table test",total:111.05,total_all:99.95,updated:1649833845}:(s=t.state.orders.filter((function(t){return t._id==e}))[0],o={},i=new Date),o.debug=r,n)o.print=n.template;else{var d=t.state.settings.templates.filter((function(e){return"receipt"==e.type&&e.user==t.state.user.id}));0==d.length&&(d=t.state.settings.templates.filter((function(t){return"receipt"==t.type&&""==t.user}))),o.print=d.length>0?d[0].template:"Kenzap Cloud: no receipt template found",n=d.length>0?d[0]:{}}var l=o.print.indexOf("[W:"),m=20;-1!=l&&(m=parseInt(o.print.substr(l+3,2)),o.print=o.print.substr(0,l)+o.print.substr(l+6,o.print.length)),o.print=o.print.replace(/{{order_id}}/g,s.id),o.print=o.print.replace(/{{order_table}}/g,s.table?s.table:""),o.print=o.print.replace(/{{date_time}}/g,i.toLocaleString([],{dateStyle:"medium",timeStyle:"short"})),o.print=o.print.replace(/{{order_items}}/g,H(t,s,"",m));var v=o.print.matchAll(/{{order_items:(.*?):start}}/g);Array.from(v,(function(t){return t[1]})).forEach((function(e){var a=H(t,s,e,m),n="{{order_items:"+e+"}}",r=new RegExp(n,"g");if(o.print=o.print.replace(r,a),a.length<2){var i=o.print.indexOf("{{order_items:"+e+":start}}"),d=o.print.indexOf("{{order_items:"+e+":end}}")+("{{order_items:"+e+":end}}").length;o.print=o.print.slice(0,i)+o.print.slice(d)}else n="\n{{order_items:"+e+":start}}",r=new RegExp(n,"g"),o.print=o.print.replace(r,""),n="\n{{order_items:"+e+":end}}",r=new RegExp(n,"g"),o.print=o.print.replace(r,"")}));var h=s.note&&"<br>"!=s.note?s.note:"";h.length>0&&(o.print=o.print.replace(/{{order_note}}/g,"[C]================================\n"+h+"\n[C]================================\n")),o.print=o.print.replace(/{{total}}/g,g(t,s.price.total)),o.print=o.print.replace(/{{tax_total}}/g,g(t,s.price.tax_total)),o.print=o.print.replace(/{{discount_total}}/g,g(t,s.price.discount_total)),o.print=o.print.replace(/{{grand_total}}/g,g(t,s.price.grand_total));var y="";y+="[L]"+__("Subtotal")+"[R]"+g(t,s.price.total)+"\n",s.price.discount_total>0&&(y+="[L]"+__("Discount")+"[R]-"+g(t,s.price.discount_total)+"\n"),s.price.fee_total>0&&(y+="[L]"+t.state.settings.fee_display+"[R]"+g(t,s.price.fee_total)+"\n"),s.price.tax_total>0&&(y+="[L]"+t.state.settings.tax_display+"[R]"+g(t,s.price.tax_total)+"\n"),s.price.grand_total>0&&(y+="[L]"+__("Grand Total")+"[R]"+g(t,s.price.grand_total)),o.print=o.print.replace(/{{order_totals}}/g,y),document.querySelector("#qr-number")&&(o.print=o.print.replace(/{{qr_number}}/g,document.querySelector("#qr-number").value)),o.debug&&console.log(o.print);var b="user"==a?n.user_print:n.auto_print;return o.user=t.state.user.id,o.printers=b,o.type="receipt",o.print=T(o.print,m),fetch("https://api-print.kenzap.cloud:5001/",{method:"post",headers:u,body:JSON.stringify({query:{print:{type:"print",data:o,sid:c()}}})}).then((function(t){return t.json()})).then((function(t){t.success?f(__("Printing order #"+s.id)):p(t)})).catch((function(t){p(t)})),t.state.printRequest=null,!0},T=function(t,e){var n,r="",o=s(t.split("\n"));try{for(o.s();!(n=o.n()).done;){var i=n.value,d=e,c=i.indexOf("[S]"),l=i.indexOf("[R]"),u=i.indexOf("[L]"),p=i.indexOf("[C]");if(d-=O(i)?O(i):1,-1!=c&&(i=i.substr(0,c)+i.substr(c+3,i.length)),-1!=l){var m=d-(i.substr(0,l)+i.substr(l+3,i.length)).length;-1!=u&&(m+=3),-1!=p&&(m+=3),i=i.substr(0,l)+C(m)+i.substr(l+3,i.length)}if(-1!=u){var v=d-(i.substr(0,u)+i.substr(u+3,i.length)).length;i=i.substr(0,u)+i.substr(u+3,i.length)+C(v)}if(-1!=p){var h=d-(i.substr(0,l)+i.substr(l+3,i.length)).length;i=C(Math.floor(h/2))+i.substr(0,p)+i.substr(p+3,i.length)+C(Math.ceil(h/2))}var f=0;a(i).forEach((function(t){" "==t&&(f+=1)})),console.log(f+" "+d),f>=d&&(i=""),r+=i+"\n"}}catch(t){o.e(t)}finally{o.f()}return r},C=function(t){for(var e="",a=0;a<=t;a++)e+=" ";return e},M=function(t,e,a,n){n-=1;for(var r="",s=0,o=!0,i=0;i<t.length;i++)r+=t[i],s+=1+O(t[i]),o&&s>=n-(e+a)&&(r+="\n[L]",s=0,o=!1),s>=n-a&&(r+="\n[L]",s=0);return r},O=function(t){for(var e=/[\u3400-\u4db5\u4e00-\u9fa5\uf900-\ufa2d]/,a=0,n=!1,r=t.length,s=0;s<r;s++){var o=t.charAt(s);e.test(o)&&(a+=n?2:1,n=!1)}return a},H=function(t,e,a,n){var r="";for(var s in e.items)if(null==e.items[s].cats&&(e.items[s].cats=[]),e.items[s].cats.includes(a)||!(a.length>0)){var o=g(t,e.items[s].total);for(var i in r+="[L]".concat(e.items[s].qty," X ").concat(M(__(e.items[s].title),(e.items[s].qty+"").length+3,(o+"").length,n),"[R]").concat(o,"\n"),e.items[s].variations){for(var d in r+="[L] ".concat(M(__(e.items[s].variations[i].title),1,0,n),":"),e.items[s].variations[i].list)r+=" ".concat(__(e.items[s].variations[i].list[d].title),",");r.endsWith(",")&&(r=r.substring(0,r.length-1)+"\n"),r.endsWith("\n")||(r+="\n")}}return r.endsWith("\n")&&(r=r.substring(0,r.length-1)),r},z=function(t,e){for(var a=localStorage.hasOwnProperty("last_print_id")?localStorage.getItem("last_print_id"):0,n=t.state.orders.length;n>0;)if(n--,"new"==t.state.orders[n].status&&parseInt(t.state.orders[n].id)>a)return localStorage.setItem("last_print_id",t.state.orders[n].id),L(t,t.state.orders[n]._id,"auto",e),!1},E={_this:null,firstLoad:!0,state:{orderSingle:null},render:function(t,e){if("1"==t.state.settings.tables){var a=t.state.settings.table_list.trim().split("\n"),n='<div id="table_list" class="row row-cols-1 row-cols-lg-5 row-cols-md-3 row-cols-sm-2 g-3 mb-3">';t.state.orders.forEach((function(t){t.table&&t.table.length>0&&(a.includes(t.table)||a.push(t.table))})),console.log(a),a.forEach((function(e,a){n+=E.structTableCard(t,a,e,{orders:t.state.orders,meta:t.state.meta})})),n+="</div>",document.querySelector("#table_list")&&document.querySelector("#table_list").remove(),document.querySelector("#orders-after-header").insertAdjacentHTML("beforeend",n),E.firstLoad&&(E.firstLoad=!1,m(".print-qr",(function(e){e.preventDefault(),function(t,e){var a={debug:!1},n=t.state.settings.templates.filter((function(e){return"qr"==e.type&&(""==e.user||e.user==t.state.user.id)}));a.print=n.length>0?n[0].template:"Kenzap Cloud: no qr template found",a.print=a.print.replace(/{{qr_link}}/g,"http://"+t.state.qr_settings.slug+".kenzap.site"),e=e||document.querySelector("#qr-number").value,a.print=a.print.replace(/{{qr_number}}/g,e);var r=a.print.indexOf("[W:"),s=20;-1!=r&&(s=parseInt(a.print.substr(r+3,2)),a.print=a.print.substr(0,r)+a.print.substr(r+6,a.print.length)),a.print=T(a.print,s),console.log(a.print);var o=n[0].user_print;a.user=t.state.user.id,a.printers=o,a.type="qr",fetch("https://api-print.kenzap.cloud:5001/",{method:"post",headers:u,body:JSON.stringify({query:{print:{type:"print",data:a,sid:c()}}})}).then((function(t){return t.json()})).then((function(t){t.success?f(__("Printing")):p(t)})).catch((function(t){p(t)}))}(t,e.currentTarget.dataset.qrnum)})))}},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(g(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var s in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=preview.structOrderItemTable(t,s,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center pt-2"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},structTableCard:function(t,e,a,n){var r=0,s={},i=0;n.orders.forEach((function(t,e){t.table==a+""&&t.id>i&&(r=e,s=t,i=t.id)})),(s=s||{}).id=s.id?s.id:"",s._id=s._id?s._id:"",s.created=s.created?s.created:"";var d="",c=s._id?s._id:"",l=c;switch(s.status){case"new":d="text-dark bg-warning";break;case"paid":case"processing":d="text-white bg-primary";break;case"completed":default:d="text-white bg-secondary",l="";break;case"failed":case"refunded":d="text-white bg-danger",l=""}return'\n    <div class="col">\n        <div class="card '.concat(d,' mb-2 " style="max-width: 18rem;">\n            <div class="card-header view-order po ').concat(c&&"completed"==s.status?"bg-success":"",'" data-id="').concat(c,'" data-table="').concat(a,'" ').concat(c?'data-index="'+r+'"':"",'">').concat(s.id?o("last order #%1$",s.id):"&nbsp;",'</div>\n            <div class="card-body d-flex align-items-center justify-content-center view-order po" style="min-height:140px;" data-id="').concat(l,'" data-table="').concat(a,'" ').concat(l?'data-index="'+r+'"':"",'">\n                <h5 class="card-title">').concat(__("Table %1$",a),'</h5>\n            </div>\n            <div class="card-footer d-flex justify-content-between">\n                ').concat(s.created?S(__,n.meta.time,s.created):"&nbsp;",'\n                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-qr-code-scan print-qr po ').concat(t.state.settings.qr_print?"":"d-none",' " viewBox="0 0 16 16" data-qrnum="').concat(a,'">\n                    <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"></path>\n                    <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"></path>\n                    <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"></path>\n                    <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"></path>\n                    <path d="M12 9h2V8h-2v1Z"></path>\n                </svg>\n            </div>\n        </div>\n    </div>')}},I={_this:null,state:{orderSingle:null},renderOrder:function(t,e){t.modal=document.querySelector(".order-modal"),t.modalCont=new bootstrap.Modal(t.modal),t.modalOpen=!0,t.rowMark=-1;var a=e.currentTarget.dataset.index;if(history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search+"#editing"),t.modal.addEventListener("hide.bs.modal",(function(t){-1!=window.location.href.indexOf("#editing")&&history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search)})),void 0===a)if(t.state.orderSingle={_id:"new",created:1649831099,from:"dine-in",id:"",idd:"",items:[],kid:"0",name:"dine-in",note:"",sid:c,status:"new",price:{discount_percent:0},step:1,table:e.currentTarget.dataset.table?e.currentTarget.dataset.table:"-",total:0,updated:1649833845},"new"==t.state.orderSingle._id&&"1"==t.state.settings.add_products){var n=t.state.settings.add_products_list.trim().split("\n");!function(t,e,a){fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:u,body:JSON.stringify({query:{products:{type:"find",fields:"*",key:"ecommerce-product",id:e,sortby:{field:"created",order:"DESC"}}}})}).then((function(t){return t.json()})).then((function(e){e.success&&(e.products.forEach((function(e,a){t.state.orderSingle.items.push({cats:[],id:e._id,index:a,note:"",price:e.price,qty:1,sdesc:o(e.sdesc),title:o(e.title),total:e.price,type:"new",variations:[]})})),a(t))})).catch((function(t){console.log(t),p(t)}))}(t,n,I.renderOrderUI)}else I.renderOrderUI(t);else t.state.orderSingle=t.state.orders[a],I.renderOrderUI(t);m(".print-order",(function(e){e.preventDefault(),t.state.printRequest=e.currentTarget.dataset.id,h(t.modal.querySelector(".btn-confirm"))})),t.listeners.modalSuccessBtnFunc=function(e){e.preventDefault(),t.updateOrder(a,t.state.orderSingle._id)},m(".st-modal li a",(function(e){e.preventDefault();var a=document.querySelector("#order-status-modal");a.innerHTML=t.state.statuses[e.currentTarget.dataset.key].text,a.dataset.value=e.currentTarget.dataset.key;Object.keys(t.state.statuses).forEach((function(e){t.state.statuses[e].class.split(" ").forEach((function(t){a.classList.remove(t)}))})),t.state.statuses[e.currentTarget.dataset.key].class.split(" ").forEach((function(t){a.classList.add(t)}))}))},renderOrderUI:function(t){var a;I.state.orderSingle=t.state.orderSingle;var n="";Object.keys(t.state.statuses).forEach((function(e,a){n+='<li><a class="dppi dropdown-item" data-key="'.concat(e,'" href="#">').concat(t.state.statuses[e].text,"</a></li>")}));var r='\n        <div class="d-flex justify-content-between">\n            <div class="st-modal st-opts mb-3 me-1 me-sm-3 dropdown">\n                <a class="btn btn-sm '.concat(t.state.statuses[t.state.orderSingle.status].class,' dropdown-toggle order-form" data-id="status" data-type="key" data-value="').concat(t.state.orderSingle.status,'" href="#" role="button" id="order-status-modal" data-bs-toggle="dropdown" aria-expanded="false" >\n                    ').concat(t.state.statuses[t.state.orderSingle.status].text,'\n                </a>\n                <ul class="dropdown-menu" aria-labelledby="order-status-modal">\n                    ').concat(n,'\n                </ul>\n            </div>\n            <a href="#" data-index="0" class="print-order text-success" data-id=').concat(I.state.orderSingle._id,'>\n                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"></path>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"></path>\n                </svg>\n            </a>\n        </div>\n        ');t.modal.querySelector(".modal-dialog").classList.add("modal-fullscreen"),t.modal.querySelector(".modal-header .modal-title").innerHTML=isNaN(t.state.orderSingle.from)?t.state.orderSingle.from:"#"+t.state.orderSingle.from,t.modal.querySelector(".modal-footer .btn-confirm").innerHTML="new"==t.state.orderSingle._id?__("Create"):__("Update"),t.modal.querySelector(".btn-confirm").dataset.loading=!1,t.modal.querySelector(".modal-footer .btn-secondary").innerHTML=__("Close");var s=r,o=(e(a={id:{l:__("ID"),classList:"order-form"},from:{l:__("From"),e:"text",editable:!0,classList:"order-form"},table:{l:__("Table"),e:"text",editable:!0,classList:"order-form"},items:{l:"",e:"items"},fname:{l:__("Name"),e:"text"},lname:{l:__("Surname"),e:"text"},bios:{l:__("Bios"),e:"textarea"},avatar:{l:__("Avatar"),e:"text"},email:{l:__("Email"),e:"text"},countryr:{l:__("Country"),e:"text"},cityr:{l:__("City"),e:"text"},addr1:{l:__("Address 1"),e:"textarea"},addr2:{l:__("Address 2"),e:"textarea"},post:{l:__("Post"),e:"text"},state:{l:__("State"),e:"text"},c1:{l:__("Whatsapp"),e:"text"},c2:{l:__("Messenger"),e:"text"},c3:{l:__("Line"),e:"text"},c4:{l:__("Email"),e:"text"},c5:{l:__("Telegram"),e:"text"}},"email",{l:__("Email"),e:"text"}),e(a,"bio",{l:__("Bio"),e:"text"}),e(a,"y1",{l:__("Name"),e:"text"}),e(a,"y2",{l:__("IBAN"),e:"text"}),e(a,"y3",{l:__("SWIFT"),e:"text"}),e(a,"y4",{l:__("Bank"),e:"text"}),e(a,"y5",{l:__("Bank city"),e:"text"}),e(a,"y6",{l:__("Bank country"),e:"text"}),e(a,"note",{l:__("Note"),e:"textarea"}),e(a,"s3",{l:__("Link 3"),e:"text"}),e(a,"company",{l:__("Company"),e:"text"}),e(a,"vat",{l:__("Tax ID"),e:"text"}),e(a,"grade",{l:__("Grade"),e:"text"}),e(a,"kenzap_ida",{l:__("Kenzap IDA"),e:"text"}),a);for(var i in o)if(void 0!==t.state.orderSingle[i]){var d=t.state.orderSingle[i],c=o[i].l;s+='\n            <div class="mb-3 mt-3 order-row keyx-'.concat(i," ").concat("_id"==i||"from"==i?"elipsized":"",'"  >\n                <b>').concat(c,"</b>").concat(I.renderField(t,o[i],d,i),"\n            </div>")}setTimeout((function(){I.refreshTotals()}),100),s+="",t.modal.querySelector(".modal-body").innerHTML='<div class="modal-body-cont">'+s+"</div>",t.modalCont.show(),I.tableOrderItemListeners(),I.suggestOrderItem(t),t.modal.querySelector(".edit-item").addEventListener("blur",(function(t){setTimeout((function(){document.querySelector(".s-list").dataset.toggle=!1}),500)})),I.addOrderItem(t),"new"==t.state.orderSingle._id&&I.refreshTotals(),"new"==t.state.orderSingle._id&&setTimeout((function(){document.querySelector(".edit-item").focus()}),300)},newOrder:function(t){I._this=t,m(".add-order",(function(e){I.renderOrder(t,e)}))},viewOrder:function(t){I._this=t,m(".view-order",(function(e){I.renderOrder(t,e)}))},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(g(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block p-1" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" style="min-width:50px;">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var s in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=I.structOrderItemTable(t,s,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-cats="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3 mt-2 d-flex">\n                                    <select class="form-select form-select edit-discount me-2 d-none" data-type="select" aria-label="Default payment method">\n                                        <option value="" selected="">%</option>\n                                        <option value="eNets">eNets</option>\n                                        <option value="PayNow">PayNow</option>\n                                    </select>\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center pt-2"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},itemOptions:function(t){return'\n\n        <div class="dropdown text-center">\n            <a  href="#" role="button" id="order-item-options" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical order-item-options" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="order-item-options" >\n                <li><a class="oio dropdown-item edit-item-note" data-key="edit-item-note" href="#">'.concat(__("Add note"),'</a></li>\n                <li><a class="oio dropdown-item d-none" data-key="edit-item-variation" href="#">').concat(__("Add variation"),'</a></li>\n                <li><a class="oio dropdown-ite d-none" data-key="edit-item-price" href="#">').concat(__("Adjust price"),'</a></li>\n                <li><a class="oio dropdown-item text-danger remove-item" data-key="remove-item" href="#">').concat(__("Remove"),"</a></li>\n            </ul>\n        </div>\n    ")},structOrderItemTable:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.created!=a[e].created&&(t.rowMark+=1),t.created=a[e].created,a[e].cats=a[e].cats?a[e].cats:[];var s="",i="";for(var d in a[e].variations){var c="";for(var l in a[e].variations[d].list)c+=o(a[e].variations[d].list[l].title)+" ";s+='<div><b class="me-1">'+o(a[e].variations[d].title)+"</b> <span>"+c+"</span></div> ",void 0!==a[e].variations[d].note&&a[e].variations[d].note.length>0&&(s+="<div><b>"+__("Note")+"</b> "+a[e].variations[d].note+"</div> ")}var u="";return a[e].discount_percent&&(u=" (-"+a[e].discount_percent+"%)"),a[e].discount_value&&(u=" (-"+g(t,a[e].discount_value)+")"),i+='<tr class="order-item-row-active row-mark'+t.rowMark+'" data-created="'+a[e].created+'" data-x="'+e+'" data-id="'+a[e].id+'" data-vars="'+w(JSON.stringify(a[e].variations))+'" data-cats="'+w(JSON.stringify(a[e].cats))+'">',i+='<td><div class="item-title" contenteditable="false" data-value="'+a[e].title+'" data-sdesc="'+(a[e].sdesc?a[e].sdesc:"")+'">'+o(a[e].title)+'</div><div class="item-note text-muted mb-1 '+(0!=a[e].note.length&&"<br>"!=a[e].note||n?"":"d-none")+'" contenteditable="true" data-value="'+a[e].note+'">'+a[e].note+'</div><div class="vars border-primary item-variations my-1 ps-2 text-secondary" data-value="">'+s+'</div></td><td class="qty"><div class="me-1 me-sm-3 item-qty" data-value="'+a[e].qty+'">'+a[e].qty+'</div></td><td class="tp"><div class="me-1 me-sm-3 item-total" data-price="'+a[e].price+'" data-value="'+a[e].total+'" data-discount_percent="'+(a[e].discount_percent?a[e].discount_percent:"")+'" data-discount_value="'+(a[e].discount_value?a[e].discount_value:"")+'">'+g(t,a[e].total)+u+'</div><td class="'+(r?"":"d-none")+'">'+I.itemOptions(a[e])+"</td></td>",i+="</tr>"},suggestOrderItem:function(e){v(".edit-item",(function(a){var n=a.keyCode||a.charCode;if(!(n>=34&&n<=45)){var r,s,d=a.currentTarget.value;if(1==d.length&&document.querySelector(".modal-body").scrollTo({top:document.querySelector(".edit-item").getBoundingClientRect().top-document.querySelector(".modal-body-cont").getBoundingClientRect().top-20,behavior:"smooth"}),0!=d.length&&a.currentTarget===document.activeElement)fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:u,body:JSON.stringify({query:{products:{type:"find",key:"ecommerce-product",fields:["_id","id","img","status","cats","variations","price","discounts","title"],limit:e.state.slist,term:[{type:"string",field:"status",relation:"=",value:"1"}],offset:d.length>0?0:(r=new URLSearchParams(window.location.search),s=r.get("page")?r.get("page"):1,parseInt(s)*e.state.slist-e.state.slist),search:{field:"title",s:d},sortby:{field:"title",order:"DESC"}}}})}).then((function(t){return t.json()})).then((function(a){if(i(),a.success){e.state.productsSuggestions=a.products;var n="";a.products.forEach((function(t,e){n+='<li class="s-list-item py-1" data-id="'.concat(t._id,'" data-title="').concat(t.title,'" data-index="').concat(e,'"  data-display="true" data-highlight="false">').concat(t.title,"</li>")})),document.querySelector(".s-list").innerHTML=n,document.querySelector(".s-list").dataset.toggle=!0,m(".s-list-item",(function(a){var n=a.currentTarget.dataset.index;if(console.log(e.state.productsSuggestions[n]),document.querySelector(".edit-item").dataset.index=n,document.querySelector(".edit-item").dataset.id=e.state.productsSuggestions[n]._id,document.querySelector(".edit-item").dataset.cats=JSON.stringify(e.state.productsSuggestions[n].cats),document.querySelector(".edit-item").value=e.state.productsSuggestions[n].title,document.querySelector(".edit-qty").value=1,document.querySelector(".edit-qty").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").value=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".s-list").dataset.toggle=!1,e.state.productsSuggestions[n].discounts&&e.state.productsSuggestions[n].discounts.length>0){var r='<option value="">%</option>';document.querySelector(".edit-discount").classList.remove("d-none"),e.state.productsSuggestions[n].discounts.forEach((function(t){"admin"==t.availability&&"percent"==t.type&&(r+='<option data-type="percent" value="'+t.percent+'">-'+t.percent+"%</option>"),"admin"==t.availability&&"value"==t.type&&(r+='<option data-type="value" value="'+t.value+'">-'+g(I._this,t.value)+"</option>")})),document.querySelector(".edit-discount").innerHTML=r,((t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("change",e,!0),a.addEventListener("change",e,!0)})(".edit-discount",(function(t){setTimeout((function(){s()}),300)}))}var s=function(){var t=document.querySelector(".edit-discount").options[document.querySelector(".edit-discount").selectedIndex].dataset.type,e=parseFloat(document.querySelector(".edit-qty").value)*parseFloat(document.querySelector(".edit-qty").dataset.price);isNaN(e)?e="":("percent"==t&&(e-=e*parseInt(document.querySelector(".edit-discount").value)/100),"value"==t&&(e-=parseFloat(document.querySelector(".edit-discount").value))),document.querySelector(".edit-tp").value=e};document.querySelector(".edit-qty").addEventListener("keypress",(function(t){if(8!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").addEventListener("keydown",(function(t){setTimeout((function(){s()}),300)})),document.querySelector(".edit-tp").addEventListener("keypress",(function(t){if(8!=t.which&&46!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").focus(),document.querySelector(".edit-qty").select(),document.querySelector(".item-vars-input").innerHTML=function(e,a){var n="";if(t("undefined"!==a.variations))for(var r in a.variations){var s="";for(var i in"checkbox"==a.variations[r].type&&(s="check"),"radio"==a.variations[r].type&&(s="radio"),n+="        <b>"+o(a.variations[r].title)+("1"==a.variations[r].required?' <span class="tag">'+o("required")+"</span>":"")+'</b>        <div class="kp-'+s+'" >',a.variations[r].data)switch(a.variations[r].data[i].price=b(a.variations[r].data[i].price),s){case"check":n+='                    <label>                        <input type="checkbox" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" data-index="'+i+'" data-title="'+a.variations[r].data[i].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[i].price+'" >                        <div class="checkbox">                            <svg width="20px" height="20px" viewBox="0 0 20 20">                                <path d="M3,1 L17,1 L17,1 C18.1045695,1 19,1.8954305 19,3 L19,17 L19,17 C19,18.1045695 18.1045695,19 17,19 L3,19 L3,19 C1.8954305,19 1,18.1045695 1,17 L1,3 L1,3 C1,1.8954305 1.8954305,1 3,1 Z"></path>                                <polyline points="4 11 8 15 16 6"></polyline>                            </svg>                        </div>                        <span>'+o(a.variations[r].data[i].title)+'</span>                        <div class="price">+ '+g(e,a.variations[r].data[i].price)+"</div>                    </label>";break;case"radio":n+='                    <label>                        <input type="radio" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" name="radio'+r+'" data-index="'+i+'" data-title="'+a.variations[r].data[i].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[i].price+'"  />                        <span>'+o(a.variations[r].data[i].title)+'</span>                        <div class="price">+ '+g(e,a.variations[r].data[i].price)+"</div>                    </label>"}n+="</div>"}return n}(e,e.state.productsSuggestions[n])}))}else p(a)})).catch((function(t){console.log(t),p(t)}));else document.querySelector(".s-list").dataset.toggle=!1}}))},tableOrderItemListeners:function(t){m(".edit-item-note",(function(t){t.preventDefault();var e=t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector(".item-note");console.log(e),e.classList.remove("d-none"),e.focus()})),m(".remove-item",(function(t){t.preventDefault(),t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.remove(),I.refreshTotals()}))},refreshTotals:function(){var t,e="",a=0,n=s(document.querySelectorAll(".item-total"));try{for(n.s();!(t=n.n()).done;){var r=t.value;a+=b(r.dataset.value)}}catch(t){n.e(t)}finally{n.f()}var i={grand_total:0,total:b(a),discount_percent:document.querySelector(".discount-percent-inp")?parseInt(document.querySelector(".discount-percent-inp").value):I.state.orderSingle.price.discount_percent?I.state.orderSingle.price.discount_percent:0,discount_value:document.querySelector(".discount-value-inp")?parseFloat(document.querySelector(".discount-value-inp").value):I.state.orderSingle.price.discount_value?I.state.orderSingle.price.discount_value:0,discount_total:0,fee_total:0,tax_total:0,tax_percent:0},d='<div class="mb-2 mt-2 order-total-subtotal order-row text-right elipsized keyx-total">\n                <b>'.concat(o("Subtotal"),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(g(I._this,i.total),"</div>\n             </div>");if(e+=d,"1"==I._this.state.settings.custom_payment_method){var c="";I._this.state.settings.payment_methods.trim().split("\n").forEach((function(t,e){c+='<option value="'.concat(t,'" ').concat(I.state.orderSingle.price.payment_method==t?"selected":""," >").concat(t,"</option>")})),e+='<div class="mb-2 mt-2 order-total-payment_method order-row text-right keyx-payment_method">\n            <b>'.concat(__("Payment"),'</b>\n            <div class="ms-2 d-inline-block" >\n                <select class="form-select form-select-sm payment-method-select" data-type="select" aria-label="Default payment method">\n                    ').concat(c,"\n                </select>\n            </div>\n        </div>")}if(document.querySelector(".order-total-subtotal")&&(document.querySelector(".order-total-subtotal").outerHTML=d),e+='<div class="mb-2 mt-2 order-total-discount d-flex align-items-center justify-content-end bd-highlight order-row keyx-total">\n                <div class="dropdown">\n                    <button class="btn border-0 dropdown-toggle fw-bold" type="button" id="discount-type" data-bs-toggle="dropdown" aria-expanded="false">\n                    '.concat(parseFloat(i.discount_value)>0?__("Discount by value"):__("Discount by %"),'\n                    </button>\n                    <ul class="dropdown-menu discount-type-option" aria-labelledby="discount-type">\n                        <li><a class="dropdown-item" data-type="percent" href="#">').concat(__("Discount by %"),'</a></li>\n                        <li><a class="dropdown-item" data-type="value" href="#">').concat(__("Discount by value"),'</a></li>\n                    </ul>\n                </div>\n                <div class="ms-2 d-inline-block" data-type="key-number" >\n                    <input type="text" autocomplete="off" maxlength="3" class="discount-percent-inp form-control form-control-sm text-end ').concat(parseFloat(i.discount_value)>0?"d-none":"",'" value="').concat(i.discount_percent,'" style="max-width:50px;">\n                    <input type="text" autocomplete="off" class="discount-value-inp ').concat(parseFloat(i.discount_value)>0?"":"d-none",' form-control form-control-sm text-end" value="').concat(i.discount_value,'" style="max-width:120px;">\n                </div>\n            </div>'),parseInt(i.discount_percent)>0&&parseInt(i.discount_percent)>0&&parseInt(i.discount_percent)<=100&&(i.discount_total=b(parseInt(i.discount_percent)*i.total)/100,a-=i.discount_total),parseFloat(i.discount_value)>0&&parseFloat(i.discount_value)>0&&(a-=i.discount_value),"1"==I._this.state.settings.fee_calc){i.fee_total=b(I._this.state.settings.fee_percent*a)/100,i.fee_percent=b(I._this.state.settings.fee_percent);var l='<div class="mb-2 mt-2 order-total-fee order-row text-right elipsized">\n                    <b>'.concat(__(I._this.state.settings.fee_display),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(g(I._this,i.fee_total),"</div>\n                 </div>");e+=l,document.querySelector(".order-total-fee")&&(document.querySelector(".order-total-fee").outerHTML=l),a+=i.fee_total}if("1"==I._this.state.settings.tax_calc){i.tax_total=b(a*parseFloat(I._this.state.settings.tax_percent)/100),i.tax_percent=b(I._this.state.settings.tax_percent);var u='<div class="mb-2 mt-2 order-total-tax order-row text-right elipsized">\n                    <b>'.concat(I._this.state.settings.tax_display,'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(g(I._this,i.tax_total),"</div>\n                 </div>");e+=u,document.querySelector(".order-total-tax")&&(document.querySelector(".order-total-tax").outerHTML=u),a+=i.tax_total}i.grand_total=b(a);var p='<div class="mb-2 mt-2 order-total-grandtotal order-row text-right elipsized">\n                <b>'.concat(o("Grand Total"),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(g(I._this,i.grand_total),"</div>\n             </div>");e+=p,document.querySelector(".order-total-grandtotal")&&(document.querySelector(".order-total-grandtotal").outerHTML=p),document.querySelector(".order-total")?document.querySelector(".order-total").dataset.price=encodeURIComponent(JSON.stringify(i)):(document.querySelector(".modal-body-cont").insertAdjacentHTML("beforeend",'<div class="mt-5 order-total order-form text-end" data-type="price" data-price="'.concat(encodeURIComponent(JSON.stringify(i)),'">').concat(e,"</div>")),m(".discount-type-option li a",(function(t){switch(t.preventDefault(),document.querySelector("#discount-type").dataset.type=t.currentTarget.dataset.type,console.log(t.currentTarget.dataset.type),t.currentTarget.dataset.type){case"value":document.querySelector("#discount-type").innerHTML=o("Discount by value"),document.querySelector(".discount-value-inp").style.maxWidth="120px",document.querySelector(".discount-value-inp").classList.remove("d-none"),document.querySelector(".discount-percent-inp").classList.add("d-none"),document.querySelector(".discount-percent-inp").value=0;break;case"percent":document.querySelector("#discount-type").innerHTML=o("Discount by %"),document.querySelector(".discount-percent-inp").style.maxWidth="70px",document.querySelector(".discount-value-inp").classList.add("d-none"),document.querySelector(".discount-percent-inp").classList.remove("d-none"),document.querySelector(".discount-value-inp").value=0}I.refreshTotals()})),_(".discount-percent-inp",[8]),v(".discount-percent-inp",(function(t){parseInt(t.currentTarget.value)>100||parseInt(t.currentTarget.value)<0?t.currentTarget.setCustomValidity("wrong percent value"):t.currentTarget.setCustomValidity(""),t.currentTarget.parentElement.classList.add("was-validated"),t.currentTarget.style.maxWidth="70px",I.refreshTotals()})),_(".discount-value-inp",[8,46]),v(".discount-value-inp",(function(t){parseInt(t.currentTarget.value)<0||parseInt(t.currentTarget.value)>i.total?t.currentTarget.setCustomValidity("wrong discount value"):t.currentTarget.setCustomValidity(""),t.currentTarget.parentElement.classList.add("was-validated"),t.currentTarget.style.maxWidth="120px",I.refreshTotals()})))},addOrderItem:function(t){m(".add-item",(function(e){var a=[],n={};n.id=document.querySelector(".edit-item").dataset.id,n.cats=JSON.parse(document.querySelector(".edit-item").dataset.cats),n.title=document.querySelector(".edit-item").value,n.total=parseFloat(document.querySelector(".edit-tp").value),n.price=parseInt(document.querySelector(".edit-tp").dataset.price),n.qty=parseInt(document.querySelector(".edit-qty").value),n.note="",n.created=I.state.orderSingle.updated,n.variations=[];var r=document.querySelector(".edit-discount").options[document.querySelector(".edit-discount").selectedIndex].dataset.type;"percent"==r&&(n.discount_percent=document.querySelector(".edit-discount").value),"value"==r&&(n.discount_value=document.querySelector(".edit-discount").value);var o,i=0,d=s(document.querySelectorAll(".item-vars-input input"));try{for(d.s();!(o=d.n()).done;){var c=o.value,l=i;c.checked&&(n.variations[l]||(n.variations[l]={}),n.variations[l].list||(n.variations[l].list={}),n.variations[l].title||(n.variations[l].title=c.dataset.titlev),n.variations[l].list["_"+c.dataset.index]={title:c.dataset.title,price:parseFloat(c.dataset.price)},n.total+=n.qty*parseFloat(c.dataset.price),i+=1)}}catch(t){d.e(t)}finally{d.f()}if(n.title.length<2)alert(__("Incorrect product data"));else{a.push(n);var u=I.structOrderItemTable(t,0,a,!0);document.querySelector(".new-item-row").insertAdjacentHTML("beforebegin",u),I.tableOrderItemListeners(),I.refreshTotals(),document.querySelector(".edit-item").value="",document.querySelector(".edit-tp").value="",document.querySelector(".edit-qty").value="",document.querySelector(".edit-discount").value="",document.querySelector(".item-vars-input").innerHTML="",setTimeout((function(){document.querySelector(".edit-item").focus()}),300)}}))}},A={state:{firstLoad:!0,modalCont:null,modalOpen:!1,playSound:{allowed:!1,ids:null,nids:[],n:0,max_times:5,timer:null,audio:new Audio("https://kenzap.com/static/swiftly.mp3")},orderIDs:[],printLink:null,printRequest:null,user:{},orders:[],settings:{},qr_settings:{},orderSingle:[],updates:{last_order_id:"",last_order_update:0},playTitleTimer:null,refreshTimer:null,statuses:[],limit:200,slistLimit:10,productsSuggestions:[]},init:function(){A.getData();var t=function(t){A.state.firstLoad&&(A.state.updates.last_order_id=t.last_order_id,A.state.updates.last_order_update=t.last_order_update),t.last_order_update!=A.state.updates.last_order_update&&(q(A,1),A.getData(),A.state.updates.last_order_id=t.last_order_id,A.state.updates.last_order_update=t.last_order_update)};A.state.refreshTimer=setInterval((function(){!function(t,e,a){fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:u,body:JSON.stringify({query:{updates:{type:"updates",source:e}}})}).then((function(t){return t.json()})).then((function(e){e.success&&(a(e),k(t,e.messages))})).catch((function(t){}))}(A,["messages","last_order_id"],t)}),5e3)},getData:function(){A.state.firstLoad&&(()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")})(),A.state.printRequest&&L(A,A.state.printRequest,"user");var t=document.querySelector(".search-input")?document.querySelector(".search-input").value:"",e=document.querySelector("#order-status")?document.querySelector("#order-status").dataset.value:"";document.querySelector("body.modal-open")||fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:u,body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar","id"],token:l("kenzap_token")},locale:{type:"locale",source:["extension"],key:"ecommerce"},orders:{type:"find",key:"ecommerce-order",fields:"*",term:""!=e?"status='"+e+"'":"",limit:A.state.limit,search:{field:"from",s:t},sortby:{field:"created",order:"DESC"}},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_percent_auto","tax_percent","tax_display","fee_calc","fee_percent","fee_display","payment_methods","custom_payment_method","tables","table_list","add_products","add_products_list","templates"]}}})}).then((function(t){return t.json()})).then((function(t){i(),t.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(t),A.loadPageStructure(),A.renderPage(t),A.initListeners(),A.initFooter(),A.state.firstLoad=!1):p(t)})).catch((function(t){p(t)}))},authUser:function(t){t.user&&t.user.success},loadPageStructure:function(){A.state.firstLoad&&(document.querySelector("#contents").innerHTML='\n      <div class="container ec-orders">\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n            <nav class="bc" aria-label="breadcrumb"></nav>\n            <button class="btn btn-primary add-order btn-add mt-3 mb-1 mt-md-0 mb-md-0" type="button">'.concat(o("New order"),'</button>\n        </div>\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n          <div>\n            <div class="col-md-12 page-title">\n              <div class="st-opts st-table dropdown">\n                  <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="order-status" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                    ').concat(o("All"),'\n                  </a>\n                  <ul class="dropdown-menu" aria-labelledby="order-status">\n                    <li><a class="dppi dropdown-item" data-key="" href="#" >').concat(o("All"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="new" href="#" >').concat(o("New"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="paid" href="#" >').concat(o("Paid"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="processing" href="#" >').concat(o("Processing"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="completed" href="#" >').concat(o("Completed"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="canceled" href="#" >').concat(o("Canceled"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="failed" href="#" >').concat(o("Failed"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="refunded" href="#" >').concat(o("Refunded"),'</a></li>\n                  </ul>\n              </div>\n              <div class="st-opts" >\n                <div class="input-group-sm mb-0 justify-content-start mb-sm-0" >\n                  <input id="usearch" type="text" class="inp form-control search-input" autocomplete="off" placeholder="').concat(o("Search order"),'">\n                </div>\n                \x3c!-- <a id="viewSum" href="#" style="margin-left:16px;">view summary</a> --\x3e\n              </div>\n            </div>\n          </div>\n          <div class="qr-print-cnt d-none align-self-center my-3 my-md-0">\n            <div class="d-inline-block">\n              <input id="qr-number" type="text" class="inp form-control form-control-sm qr-number p-0 px-2 me-2 ms-0" autocomplete="off" style="max-width:100px;" placeholder="').concat(__("QR number"),'">\n            </div>\n            <div class="d-inline-block">\n              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-qr-code-scan print-qr po" viewBox="0 0 16 16">\n                <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"/>\n                <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"/>\n                <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"/>\n                <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"/>\n                <path d="M12 9h2V8h-2v1Z"/>\n              </svg>\n            </div>\n          </div> \n        </div>\n\n        <div id="orders-after-header">\n\n\n        </div>\n\n        <div class="row">\n          <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n            <div class="card border-white shadow-sm border-0">\n              <div class="card-body p-0">\n \n                <div class="table-responsive">\n                  <table class="table table-hover table-borderless align-middle table-striped table-p-list mb-0">\n                    <thead>\n                      <tr>\n                        <th><span class="ps-1">').concat(o("From"),'</span></th>\n                        <th class="d-none d-sm-table-cell">').concat(o("Status"),"</th>\n                        <th>").concat(o("Subtotal"),'</th>\n                        <th class="d-none d-sm-table-cell">').concat(o("Time"),'</th>\n                        <th></th>\n                      </tr>\n                    </thead>\n                    <tbody class="list">\n\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="modal order-modal" tabindex="-1" data-backdrop="static" data-keyboard="false">\n        <div class="modal-dialog ">\n          <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title"></h5>\n                <button type="button" class="btn-close align-self-start-remove" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body">\n              \n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-primary btn-confirm"></button>\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n              </div>\n          </div>\n        </div>\n      </div>\n\n    '))},renderPage:function(t){if(A.state.firstLoad&&((t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let a of t)void 0===a.link?e+=`<li class="breadcrumb-item">${a.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:d("https://dashboard.kenzap.cloud"),text:o("Dashboard")},{link:d("/"),text:o("E-commerce")},{text:o("Orders")}]),A.state.statuses={new:{text:o("New"),class:"btn-warning text-dark fw-light"},paid:{text:o("Paid"),class:"btn-primary fw-light"},processing:{text:o("Processing"),class:"btn-primary fw-light"},completed:{text:o("Completed"),class:"btn-success fw-light"},canceled:{text:o("Canceled"),class:"btn-secondary fw-light"},failed:{text:o("Failed"),class:"btn-danger fw-light"},refunded:{text:o("Refunded"),class:"btn-danger fw-light"}}),A.state.user=t.user,A.state.orders=t.orders,A.state.meta=t.meta,A.state.settings=t.settings,A.state.settings.templates||(A.state.settings.templates=[]),A.state.settings.qr_print=function(t){return t.state.settings.templates.filter((function(e){return"qr"==e.type&&(""==e.user||e.user==t.state.user.id)})).length>0}(A),A.state.settings.qr_print&&document.querySelector(".qr-print-cnt").classList.remove("d-none"),0!=t.orders.length){var e=[];A.state.newOrderCount=[];var a="",n="";for(var r in t.orders){e.push(t.orders[r]._id),void 0===t.orders[r].status&&(t.orders[r].status="new"),"new"==t.orders[r].status&&(n+=t.orders[r].id);var s=A.state.orderIDs.includes(t.orders[r]._id)||A.state.firstLoad?"":"new";a+='\n            <tr class="'.concat(s,'">\n              <td class="details view-order" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'">\n                <div class="ps-1" >\n                  <b class="">').concat(t.orders[r].id,"</b> ").concat(t.orders[r].from,'\n                  <div class=" elipsized fst-italic">').concat(t.orders[r].note?t.orders[r].note:"",'</div>\n                  <div class=" d-sm-none"> <span class="me-2">').concat(A.getStatus(t.orders[r].status),'</span> <span class="text-muted">').concat(S(__,t.meta.time,t.orders[r].created),'</span> </div>\n                </div>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span class="fs-12">').concat(A.getStatus(t.orders[r].status),'</span>\n              </td>\n              <td>\n                <span style="font-size:18px;">').concat(g(A,t.orders[r].total),'</span>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span style="font-size:18px;">').concat(S(__,t.meta.time,t.orders[r].created),'</span>\n              </td>\n              <td class="last">\n                <a href="#" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="view-order text-success d-none me-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>\n                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>\n                </svg></a>\n                <a href="kenzapprint://kenzapprint.app?data=').concat(encodeURIComponent(JSON.stringify({print:'[C]<u><font size="big">ORDER{{order_id_short}}</font></u>\n[C]Fu Zhen Seafood\n[C]<u type=double>{{date_time}}</u>\n[C]\n[C]================================" \n[L]\n[L]<b>BEAUTIFUL SHIRT</b>[R]9.99€\n[L]  + Size : S\n[L]\n[L]<b>AWESOME HAT</b>[R]24.99€\n[L]  + Size : 57/58\n[L]\n[C]--------------------------------\n[R]TOTAL PRICE :[R]34.98€\n[R]TAX :[R]4.23€'})),'" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="print-order-dis d-none text-success me-2">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>\n                </svg></a>\n                <a href="#" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="remove-order text-danger me-2"><svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n                </svg></a>\n              </td>\n            </tr>')}A.state.playSound.ids&&A.state.playSound.ids!=n&&A.state.playSound.ids.length<n.length&&q(A,3),A.state.playSound.ids=n,A.state.orderIDs=e,document.querySelector(".table tbody").innerHTML=a}else document.querySelector(".table tbody").innerHTML='<tr><td colspan="5">'.concat(o("No orders to display."),"</td></tr>")},getStatus:function(t){return'<div class="badge '.concat(A.state.statuses[t].class,'">').concat(A.state.statuses[t].text,"</div>")},initListeners:function(){E.render(A),I.viewOrder(A),m(".remove-order",A.listeners.removeOrder),m(".st-table li a",A.listeners.changeStatus),A.state.firstLoad&&(!function(t){var e=t.state.settings.templates.filter((function(e){return"new"==e.auto_print_action&&"receipt"==e.type&&(""==e.user||e.user==t.state.user.id)}));if(0==e.length)return!1;z(t,e[0]),setInterval((function(t){z(t,e[0])}),7e3,t)}(A),I.newOrder(A),m(".modal .btn-primary",A.listeners.modalSuccessBtn),v(".search-input",A.listeners.searchOrders),document.body.addEventListener("touchstart",(function(){A.state.playSound.allowed=!0}),!1),document.body.addEventListener("mousedown",(function(){A.state.playSound.allowed=!0}),!1),window.addEventListener("hashchange",(function(t){if(A.modalCont)return t.preventDefault(),A.modalOpen=!1,A.modalCont.hide(),!1})))},listeners:{newOrder:function(t){},changeStatus:function(t){t.preventDefault();var e=document.querySelector("#order-status");""==t.currentTarget.dataset.key?(e.innerHTML=o("All"),e.dataset.value=""):(e.innerHTML=A.state.statuses[t.currentTarget.dataset.key].text,e.dataset.value=t.currentTarget.dataset.key);Object.keys(A.state.statuses).forEach((function(t){A.state.statuses[t].class.split(" ").forEach((function(t){e.classList.remove(t)})),e.classList.remove("btn-outline-secondary")})),""==t.currentTarget.dataset.key?e.classList.add("btn-outline-secondary"):A.state.statuses[t.currentTarget.dataset.key].class.split(" ").forEach((function(t){e.classList.add(t)})),A.getData()},removeOrder:function(t){t.preventDefault(),confirm(__("Completely remove this order?"))&&fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:u,body:JSON.stringify({query:{product:{type:"delete-order",id:t.currentTarget.dataset.id,sid:c()}}})}).then((function(t){return t.json()})).then((function(t){t.success?A.getData():p(t)})).catch((function(t){p(t)}))},searchOrders:function(t){t.preventDefault(),A.getData()},modalSuccessBtn:function(t){A.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},updateOrder:function(t,e){var a=document.querySelector(".modal");if("true"!==a.querySelector(".btn-confirm").dataset.loading){a.querySelector(".btn-confirm").dataset.loading=!0,a.querySelector(".btn-confirm").innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+o("Loading..");var n,r={},i=s(document.querySelectorAll(".order-form"));try{for(i.s();!(n=i.n()).done;){var d=n.value;switch(d.dataset.type){case"key":r[d.dataset.id]=d.dataset.value;break;case"key-number":r[d.dataset.id]=b(d.dataset.value);break;case"items":r.items=[];var l,m=s(document.querySelectorAll(".order-item-row-active"));try{for(m.s();!(l=m.n()).done;){var v=l.value,h=JSON.parse(x(v.dataset.vars)),g=JSON.parse(x(v.dataset.cats)),_={id:v.dataset.id,qty:parseInt(v.querySelector(".item-qty").dataset.value),cats:g||[],note:v.querySelector(".item-note").innerHTML,type:"new",index:"0",price:parseFloat(v.querySelector(".item-total").dataset.price),sdesc:v.querySelector(".item-title").dataset.sdesc,title:v.querySelector(".item-title").dataset.value,total:parseFloat(v.querySelector(".item-total").dataset.value),variations:"new"==e?[]:h||[]};v.querySelector(".item-total").dataset.discount_percent&&(_.discount_percent=v.querySelector(".item-total").dataset.discount_percent),v.querySelector(".item-total").dataset.discount_value&&(_.discount_value=v.querySelector(".edit-total").dataset.discount_value),r.items.push(_)}}catch(t){m.e(t)}finally{m.f()}break;case"text":r[d.dataset.id]=d.innerHTML;break;case"email":case"emails":case"select":case"textarea":r[d.id]=d.value;break;case"radio":r[d.id]=d.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector("input:checked").value;break;case"price":r.price=JSON.parse(decodeURIComponent(d.dataset.price)),r.total=r.price.total,r.total_all=r.price.grand_total,document.querySelector(".payment-method-select")&&(r.price.payment_method=document.querySelector(".payment-method-select").value)}}}catch(t){i.e(t)}finally{i.f()}var S=new Date;r.created_ymd=S.getUTCFullYear()+""+y(S.getUTCMonth()+1)+y(S.getUTCDate()),r.created_ym=S.getUTCFullYear()+""+y(S.getUTCMonth()+1),r.created_y=S.getUTCFullYear()+"",r.printed=!!A.state.printRequest,"new"==e?(r.name=r.from,r.customer={first_name:r.from,last_name:"",kid:0},fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:u,body:JSON.stringify({query:{order:{type:"create-order",key:"ecommerce-order",data:r}}})}).then((function(t){return t.json()})).then((function(t){t.success?(A.modalCont.hide(),f(__("Order created")),"new"==A.state.printRequest&&(A.state.printRequest=r._id),A.getData()):p(t)})).catch((function(t){p(t)}))):fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:u,body:JSON.stringify({query:{order:{type:"update-order",id:e,sid:c(),data:r}}})}).then((function(t){return t.json()})).then((function(t){t.success?(A.modalCont.hide(),f(__("Order updated")),A.getData()):p(t)})).catch((function(t){p(t)}))}},initFooter:function(){var t,e;t=__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),e="",document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${t}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${e}</span>\n    </div>`}};A.init()}();
