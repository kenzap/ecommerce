!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,d=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){d=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(d)throw o}}}}const r=t=>0===(t=String(t)).length?"":(t=((t,...e)=>{let a=(t,e)=>(e.forEach(((e,a)=>{t=t.replace("%"+(a+1)+"$",e)})),t);return void 0===window.i18n||void 0===window.i18n.state.locale.values[t]?a(t,e):a(window.i18n.state.locale.values[t],e)})(t)).replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[t]))),s=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},o=t=>{let e=new URLSearchParams(window.location.search),a=e.get("sid")?e.get("sid"):"",n=-1==t.indexOf("?")?"?sid="+a:"&sid="+a;return t+n},i=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},d=t=>{let e=t+"=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let n=a[t];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},c={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+d("kenzap_api_key"),"Kenzap-Locale":d("locale")?d("locale"):"en","Kenzap-Header":(()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+i()+"/"+d("locale");return e!=d("check")&&(t=0,console.log("refresh")),((t,e,a)=>{let n="";if(a){let t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),n=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+n+";path=/;domain=.kenzap.cloud"})("check",e,5),t})(),"Kenzap-Token":d("kenzap_token"),"Kenzap-Sid":i()},l=t=>{if(isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",i()),a.append("token",d("kenzap_token")),a.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)},u=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("click",e,!0),a.addEventListener("click",e,!0)},p=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("keyup",e,!0),a.addEventListener("keyup",e,!0)},m=t=>{let e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)},v=t=>{if(!document.querySelector(".toast")){let t='\n        <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",t)}let e=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=t,e.show()};var h=function(t){return(""+t).length<2?"0"+t:t},y=function(t,e){switch(e=f(e),e=(Math.round(100*parseFloat(e))/100).toFixed(2),t.state.settings.currency_symb_loc){case"left":e=t.state.settings.currency_symb+e;break;case"right":e+=t.state.settings.currency_symb}return e},f=function(t){return t=t||0,t=parseFloat(t),t=Math.round(100*t)/100},g=function(t,e){document.querySelector(t)&&document.querySelector(t).addEventListener("keypress",(function(a){if(!e.includes(a.which)&&isNaN(String.fromCharCode(a.which))||32==a.which||document.querySelector(t).value.includes(String.fromCharCode(a.which))&&e.includes(a.which))return a.preventDefault(),!1}))},b=function(t,e,a){var n=(e=parseInt(e))-(a=parseInt(a));if(n<60)return t("moments ago");if(n<3600)return parseInt(n/60)+" "+t("minutes ago");if(n<86400)return parseInt(n/60/60)+" "+t("hours ago");var r=new Date(1e3*a),s=[t("Jan"),t("Feb"),t("Mar"),t("Apr"),t("May"),t("Jun"),t("Jul"),t("Aug"),t("Sep"),t("Oct"),t("Nov"),t("Dec")],o=r.getFullYear(),i=s[r.getMonth()],d=r.getDate();return r.getHours(),r.getMinutes(),r.getSeconds(),a=d+" "+i+" "+o},_=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},w=function(t){return t=(t=(t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&#39;/g,"'")).replace(/&amp;/g,"&")},S=function(t,e){t.state.playSound.n=0,t.state.playSound.timer&&clearInterval(t.state.playSound.timer),t.state.playSound.allowed&&t.state.playSound.audio.play(),console.log("playing "+t.state.playSound.allowed);try{t.state.playSound.allowed&&((a=navigator.userAgent.toLowerCase()).match(/iphone/i)||a.match(/ipod/i)||a.match(/ipad/i)||a.match(/android/i))&&window.navigator.vibrate(200)}catch(t){}var a;1!=e&&(t.state.playSound.timer=setInterval((function(){t.state.playSound.allowed&&(t.state.playSound.audio.play(),t.state.playSound.n>e&&clearInterval(t.state.playSound.timer),t.state.playSound.n+=1)}),5e3))},x=function(t,e){var a="",r=!1;if(e.forEach((function(e){t.state.playSound.nids.includes(e._id)||(t.state.playSound.nids.push(e._id),r=!0),document.querySelector('#contents .container [data-id="'+e._id+'"]')||(a+='\n\n            <div class="alert alert-'.concat(e.color,' alert-dismissible fade show" role="alert" data-id="').concat(e._id,'">\n                <div class="d-flex align-items-center">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-square flex-shrink-0 me-2" viewBox="0 0 16 16">\n                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n                        <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>\n                    </svg>\n                    <div>\n                    ').concat(e.msg,'\n                    </div>\n                </div>\n                <button type="button" class="btn-close btn-dismiss-notify" data-bs-dismiss="alert" aria-label="Close" data-id="').concat(e._id,'"></button>\n            </div>'))})),r&&(console.log("notify play sound"),S(t,1),t.getData()),document.querySelector("#contents .container")&&document.querySelector("#contents .container").insertAdjacentHTML("afterbegin",a),function(t,e){if(document.querySelector(t)){var a,r=n(document.querySelectorAll(t));try{for(r.s();!(a=r.n()).done;){var s=a.value;s.removeEventListener("click",e,!0),s.addEventListener("click",e,!0)}}catch(t){r.e(t)}finally{r.f()}}}(".btn-dismiss-notify",(function(t){fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:c,body:JSON.stringify({query:{updates:{type:"dismiss",id:t.currentTarget.dataset.id}}})}).then((function(t){return t.json()})).then((function(t){t.success})).catch((function(t){}))})),document.querySelector(".order-details")){var s,o=n(document.querySelectorAll(".order-details"));try{for(o.s();!(s=o.n()).done;){var i=s.value;if("1"==i.dataset.assigned)return;i.dataset.assigned=1,i.addEventListener("click",(function(t){var e=document.querySelector(".view-order[data-id='"+t.currentTarget.dataset.id+"']");m(e)}),!0)}}catch(t){o.e(t)}finally{o.f()}}},q={_this:null,state:{orderSingle:null},render:function(t,e){if("1"==t.state.settings.tables){var a='<div id="table_list" class="row row-cols-1 row-cols-lg-5 row-cols-md-3 row-cols-sm-2 g-3 mb-3">';t.state.settings.table_list.trim().split("\n").forEach((function(e,n){a+=q.structTableCard(t,n,e,{orders:t.state.orders,meta:t.state.meta})})),a+="</div>",document.querySelector("#table_list")&&document.querySelector("#table_list").remove(),document.querySelector("#orders-after-header").insertAdjacentHTML("beforeend",a)}},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(y(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var s in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=preview.structOrderItemTable(t,s,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center pt-2"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},structTableCard:function(t,e,a,n){var r=0,s={};n.orders.forEach((function(t,e){t.table==a+""&&(r=e,s=t)})),(s=s||{}).id=s.id?s.id:"",s._id=s._id?s._id:"",s.created=s.created?s.created:"";var o="";switch(s.status){case"new":o="text-dark bg-warning";break;case"paid":case"processing":o="text-white bg-primary";break;case"completed":o="text-white bg-success";break;case"failed":case"refunded":o="text-white bg-danger";break;default:o="text-white bg-secondary"}return'\n    <div class="col">\n        <div class="card '.concat(o," ").concat((s._id,"view-order po"),' mb-2 " data-id="').concat(s._id?s._id:"",'" data-table="').concat(a,'" ').concat(s._id?'data-index="'+r+'"':"",'" style="max-width: 18rem;">\n            <div class="card-header">').concat(s.id?"#"+s.id:"&nbsp;",'</div>\n            <div class="card-body d-flex align-items-center justify-content-center" style="min-height:140px;">\n                <h5 class="card-title">').concat(__("Table %1$",a),'</h5>\n            </div>\n            <div class="card-footer">').concat(s.created?b(__,n.meta.time,s.created):"&nbsp;","</div>\n        </div>\n    </div>")}},k={_this:null,state:{orderSingle:null},renderOrder:function(t,a){var n,r=document.querySelector(".order-modal");t.modalCont=new bootstrap.Modal(r),t.modalOpen=!0,t.rowMark=-1;var s=a.currentTarget.dataset.index;history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search+"#editing"),r.addEventListener("hide.bs.modal",(function(t){-1!=window.location.href.indexOf("#editing")&&history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search)})),t.state.orderSingle=void 0===s?{_id:"new",created:1649831099,from:"dine-in",id:"",idd:"",items:[],kid:"0",name:"dine-in",note:"",sid:i,status:"new",price:{discount_percent:0},step:1,table:a.currentTarget.dataset.table?a.currentTarget.dataset.table:"-",total:0,updated:1649833845}:t.state.orders[s],k.state.orderSingle=t.state.orderSingle;var o="";Object.keys(t.state.statuses).forEach((function(e,a){o+='<li><a class="dppi dropdown-item" data-key="'.concat(e,'" href="#">').concat(t.state.statuses[e].text,"</a></li>")}));var d='\n        <div class="d-flex justify-content-between">\n            <div class="st-modal st-opts mb-3 me-1 me-sm-3 dropdown">\n                <a class="btn btn-sm '.concat(t.state.statuses[t.state.orderSingle.status].class,' dropdown-toggle order-form" data-id="status" data-type="key" data-value="').concat(t.state.orderSingle.status,'" href="#" role="button" id="order-status-modal" data-bs-toggle="dropdown" aria-expanded="false" >\n                    ').concat(t.state.statuses[t.state.orderSingle.status].text,'\n                </a>\n                <ul class="dropdown-menu" aria-labelledby="order-status-modal">\n                    ').concat(o,'\n                </ul>\n            </div>\n            <a href="#" data-index="0" class="print-order text-success">\n                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"></path>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"></path>\n                </svg>\n            </a>\n        </div>\n        ');r.querySelector(".modal-dialog").classList.add("modal-fullscreen"),r.querySelector(".modal-header .modal-title").innerHTML=isNaN(t.state.orderSingle.from)?t.state.orderSingle.from:"#"+t.state.orderSingle.from,r.querySelector(".modal-footer .btn-confirm").innerHTML="new"==t.state.orderSingle._id?__("Create"):__("Update"),r.querySelector(".btn-confirm").dataset.loading=!1,r.querySelector(".modal-footer .btn-secondary").innerHTML=__("Close");var c=d,l=(e(n={id:{l:__("ID"),classList:"order-form"},from:{l:__("From"),e:"text",editable:!0,classList:"order-form"},table:{l:__("Table"),e:"text",editable:!0,classList:"order-form"},items:{l:"",e:"items"},fname:{l:__("Name"),e:"text"},lname:{l:__("Surname"),e:"text"},bios:{l:__("Bios"),e:"textarea"},avatar:{l:__("Avatar"),e:"text"},email:{l:__("Email"),e:"text"},countryr:{l:__("Country"),e:"text"},cityr:{l:__("City"),e:"text"},addr1:{l:__("Address 1"),e:"textarea"},addr2:{l:__("Address 2"),e:"textarea"},post:{l:__("Post"),e:"text"},state:{l:__("State"),e:"text"},c1:{l:__("Whatsapp"),e:"text"},c2:{l:__("Messenger"),e:"text"},c3:{l:__("Line"),e:"text"},c4:{l:__("Email"),e:"text"},c5:{l:__("Telegram"),e:"text"}},"email",{l:__("Email"),e:"text"}),e(n,"bio",{l:__("Bio"),e:"text"}),e(n,"y1",{l:__("Name"),e:"text"}),e(n,"y2",{l:__("IBAN"),e:"text"}),e(n,"y3",{l:__("SWIFT"),e:"text"}),e(n,"y4",{l:__("Bank"),e:"text"}),e(n,"y5",{l:__("Bank city"),e:"text"}),e(n,"y6",{l:__("Bank country"),e:"text"}),e(n,"note",{l:__("Note"),e:"textarea"}),e(n,"s3",{l:__("Link 3"),e:"text"}),e(n,"company",{l:__("Company"),e:"text"}),e(n,"vat",{l:__("Tax ID"),e:"text"}),e(n,"grade",{l:__("Grade"),e:"text"}),e(n,"kenzap_ida",{l:__("Kenzap IDA"),e:"text"}),n);for(var p in l)if(void 0!==t.state.orderSingle[p]){var v=t.state.orderSingle[p],h=l[p].l;c+='\n            <div class="mb-3 mt-3 order-row keyx-'.concat(p," ").concat("_id"==p||"from"==p?"elipsized":"",'"  >\n                <b>').concat(h,"</b>").concat(k.renderField(t,l[p],v,p),"\n            </div>")}setTimeout((function(){k.refreshTotals()}),100),c+="",r.querySelector(".modal-body").innerHTML='<div class="modal-body-cont">'+c+"</div>",t.modalCont.show(),k.tableOrderItemListeners(),k.suggestOrderItem(t),r.querySelector(".edit-item").addEventListener("blur",(function(t){setTimeout((function(){document.querySelector(".s-list").dataset.toggle=!1}),500)})),k.addOrderItem(t),"new"==t.state.orderSingle._id&&k.refreshTotals(),"new"==t.state.orderSingle._id&&setTimeout((function(){document.querySelector(".edit-item").focus()}),300),u(".print-order",(function(e){e.preventDefault(),t.state.printLink=!0,m(r.querySelector(".btn-confirm"))})),t.listeners.modalSuccessBtnFunc=function(e){e.preventDefault(),t.updateOrder(s,t.state.orderSingle._id)},u(".st-modal li a",(function(e){e.preventDefault();var a=document.querySelector("#order-status-modal");a.innerHTML=t.state.statuses[e.currentTarget.dataset.key].text,a.dataset.value=e.currentTarget.dataset.key;Object.keys(t.state.statuses).forEach((function(e){t.state.statuses[e].class.split(" ").forEach((function(t){a.classList.remove(t)}))})),t.state.statuses[e.currentTarget.dataset.key].class.split(" ").forEach((function(t){a.classList.add(t)}))}))},newOrder:function(t){k._this=t,u(".add-order",(function(e){k.renderOrder(t,e)}))},viewOrder:function(t){k._this=t,u(".view-order",(function(e){k.renderOrder(t,e)}))},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(y(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block p-1" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" style="min-width:50px;">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var s in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=k.structOrderItemTable(t,s,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-cats="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3 mt-2">\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center pt-2"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},itemOptions:function(t){return'\n\n        <div class="dropdown text-center">\n            <a  href="#" role="button" id="order-item-options" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical order-item-options" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="order-item-options" >\n                <li><a class="oio dropdown-item edit-item-note" data-key="edit-item-note" href="#">'.concat(__("Add note"),'</a></li>\n                <li><a class="oio dropdown-item d-none" data-key="edit-item-variation" href="#">').concat(__("Add variation"),'</a></li>\n                <li><a class="oio dropdown-ite d-none" data-key="edit-item-price" href="#">').concat(__("Adjust price"),'</a></li>\n                <li><a class="oio dropdown-item text-danger remove-item" data-key="remove-item" href="#">').concat(__("Remove"),"</a></li>\n            </ul>\n        </div>\n    ")},structOrderItemTable:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.created!=a[e].created&&(t.rowMark+=1),t.created=a[e].created,a[e].cats=a[e].cats?a[e].cats:[];var s="",o="";for(var i in a[e].variations){var d="";for(var c in a[e].variations[i].list)d+=a[e].variations[i].list[c].title+" ";s+="<div><b>"+a[e].variations[i].title+"</b> <span>"+d+"</span></div> ",void 0!==a[e].variations[i].note&&a[e].variations[i].note.length>0&&(s+="<div><b>"+__("Note")+"</b> "+a[e].variations[i].note+"</div> ")}return o+='<tr class="order-item-row-active row-mark'+t.rowMark+'" data-created="'+a[e].created+'" data-x="'+e+'" data-id="'+a[e].id+'" data-vars="'+_(JSON.stringify(a[e].variations))+'" data-cats="'+_(JSON.stringify(a[e].cats))+'">',o+='<td><div class="item-title" contenteditable="false" data-value="'+a[e].title+'" data-sdesc="'+(a[e].sdesc?a[e].sdesc:"")+'">'+a[e].title+'</div><div class="item-note text-muted mb-1 '+(0!=a[e].note.length&&"<br>"!=a[e].note||n?"":"d-none")+'" contenteditable="true" data-value="'+a[e].note+'">'+a[e].note+'</div><div class="vars border-primary item-variations my-1 ps-2 text-secondary" data-value="">'+s+'</div></td><td class="qty"><div class="me-1 me-sm-3 item-qty" data-value="'+a[e].qty+'">'+a[e].qty+'</div></td><td class="tp"><div class="me-1 me-sm-3 item-total" data-price="'+a[e].price+'" data-value="'+a[e].total+'" >'+y(t,a[e].total)+'</div><td class="'+(r?"":"d-none")+'">'+k.itemOptions(a[e])+"</td></td>",o+="</tr>"},suggestOrderItem:function(e){p(".edit-item",(function(a){var n=a.keyCode||a.charCode;if(!(n>=34&&n<=45)){var o,i,d=a.currentTarget.value;if(1==d.length&&document.querySelector(".modal-body").scrollTo({top:document.querySelector(".edit-item").getBoundingClientRect().top-document.querySelector(".modal-body-cont").getBoundingClientRect().top-20,behavior:"smooth"}),0!=d.length&&a.currentTarget===document.activeElement)fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:c,body:JSON.stringify({query:{products:{type:"find",key:"ecommerce-product",fields:["_id","id","img","status","cats","variations","price","title"],limit:e.state.slist,term:[{type:"string",field:"status",relation:"=",value:"1"}],offset:d.length>0?0:(o=new URLSearchParams(window.location.search),i=o.get("page")?o.get("page"):1,parseInt(i)*e.state.slist-e.state.slist),search:{field:"title",s:d},sortby:{field:"title",order:"DESC"}}}})}).then((function(t){return t.json()})).then((function(a){if(s(),a.success){e.state.productsSuggestions=a.products;var n="";a.products.forEach((function(t,e){n+='<li class="s-list-item py-1" data-id="'.concat(t._id,'" data-title="').concat(t.title,'" data-index="').concat(e,'"  data-display="true" data-highlight="false">').concat(t.title,"</li>")})),document.querySelector(".s-list").innerHTML=n,document.querySelector(".s-list").dataset.toggle=!0,u(".s-list-item",(function(a){var n=a.currentTarget.dataset.index;document.querySelector(".edit-item").dataset.index=n,document.querySelector(".edit-item").dataset.id=e.state.productsSuggestions[n]._id,document.querySelector(".edit-item").dataset.cats=JSON.stringify(e.state.productsSuggestions[n].cats),document.querySelector(".edit-item").value=e.state.productsSuggestions[n].title,document.querySelector(".edit-qty").value=1,document.querySelector(".edit-qty").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").value=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".s-list").dataset.toggle=!1;document.querySelector(".edit-qty").addEventListener("keypress",(function(t){if(8!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").addEventListener("keydown",(function(t){setTimeout((function(){var t;t=parseFloat(document.querySelector(".edit-qty").value)*parseFloat(document.querySelector(".edit-qty").dataset.price),isNaN(t)&&(t=""),document.querySelector(".edit-tp").value=t}),300)})),document.querySelector(".edit-tp").addEventListener("keypress",(function(t){if(8!=t.which&&46!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").focus(),document.querySelector(".edit-qty").select(),document.querySelector(".item-vars-input").innerHTML=function(e,a){var n="";if(t("undefined"!==a.variations))for(var s in a.variations){var o="";for(var i in"checkbox"==a.variations[s].type&&(o="check"),"radio"==a.variations[s].type&&(o="radio"),n+="        <b>"+r(a.variations[s].title)+("1"==a.variations[s].required?' <span class="tag">'+r("required")+"</span>":"")+'</b>        <div class="kp-'+o+'" >',a.variations[s].data)switch(a.variations[s].data[i].price=f(a.variations[s].data[i].price),o){case"check":n+='                    <label>                        <input type="checkbox" data-required="'+a.variations[s].required+'" data-indexv="'+s+'" data-index="'+i+'" data-title="'+a.variations[s].data[i].title+'" data-titlev="'+__(a.variations[s].title)+'" data-price="'+a.variations[s].data[i].price+'" >                        <div class="checkbox">                            <svg width="20px" height="20px" viewBox="0 0 20 20">                                <path d="M3,1 L17,1 L17,1 C18.1045695,1 19,1.8954305 19,3 L19,17 L19,17 C19,18.1045695 18.1045695,19 17,19 L3,19 L3,19 C1.8954305,19 1,18.1045695 1,17 L1,3 L1,3 C1,1.8954305 1.8954305,1 3,1 Z"></path>                                <polyline points="4 11 8 15 16 6"></polyline>                            </svg>                        </div>                        <span>'+r(a.variations[s].data[i].title)+'</span>                        <div class="price">+ '+y(e,a.variations[s].data[i].price)+"</div>                    </label>";break;case"radio":n+='                    <label>                        <input type="radio" data-required="'+a.variations[s].required+'" data-indexv="'+s+'" name="radio'+s+'" data-index="'+i+'" data-title="'+a.variations[s].data[i].title+'" data-titlev="'+__(a.variations[s].title)+'" data-price="'+a.variations[s].data[i].price+'"  />                        <span>'+r(a.variations[s].data[i].title)+'</span>                        <div class="price">+ '+y(e,a.variations[s].data[i].price)+"</div>                    </label>"}n+="</div>"}return n}(e,e.state.productsSuggestions[n])}))}else l(a)})).catch((function(t){console.log(t),l(t)}));else document.querySelector(".s-list").dataset.toggle=!1}}))},tableOrderItemListeners:function(t){u(".edit-item-note",(function(t){t.preventDefault();var e=t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector(".item-note");console.log(e),e.classList.remove("d-none"),e.focus()})),u(".remove-item",(function(t){t.preventDefault(),t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.remove(),k.refreshTotals()}))},refreshTotals:function(){var t,e="",a=0,s=n(document.querySelectorAll(".item-total"));try{for(s.s();!(t=s.n()).done;){var o=t.value;a+=f(o.dataset.value)}}catch(t){s.e(t)}finally{s.f()}var i={grand_total:0,total:f(a),discount_percent:document.querySelector(".discount-percent-inp")?parseInt(document.querySelector(".discount-percent-inp").value):k.state.orderSingle.price.discount_percent?k.state.orderSingle.price.discount_percent:0,discount_value:document.querySelector(".discount-value-inp")?parseFloat(document.querySelector(".discount-value-inp").value):k.state.orderSingle.price.discount_value?k.state.orderSingle.price.discount_value:0,discount_total:0,fee_total:0,tax_total:0,tax_percent:0},d='<div class="mb-2 mt-2 order-total-subtotal order-row text-right elipsized keyx-total">\n                <b>'.concat(r("Subtotal"),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(y(k._this,i.total),"</div>\n             </div>");if(e+=d,"1"==k._this.state.settings.custom_payment_method){var c="";k._this.state.settings.payment_methods.trim().split("\n").forEach((function(t,e){c+='<option value="'.concat(t,'" ').concat(k.state.orderSingle.price.payment_method==t?"selected":""," >").concat(t,"</option>")})),e+='<div class="mb-2 mt-2 order-total-payment_method order-row text-right keyx-payment_method">\n            <b>'.concat(__("Payment"),'</b>\n            <div class="ms-2 d-inline-block" >\n                <select class="form-select form-select-sm payment-method-select" data-type="select" aria-label="Default payment method">\n                    ').concat(c,"\n                </select>\n            </div>\n        </div>")}if(document.querySelector(".order-total-subtotal")&&(document.querySelector(".order-total-subtotal").outerHTML=d),e+='<div class="mb-2 mt-2 order-total-discount d-flex align-items-center justify-content-end bd-highlight order-row keyx-total">\n                <div class="dropdown">\n                    <button class="btn border-0 dropdown-toggle fw-bold" type="button" id="discount-type" data-bs-toggle="dropdown" aria-expanded="false">\n                    '.concat(parseFloat(i.discount_value)>0?__("Discount by value"):__("Discount by %"),'\n                    </button>\n                    <ul class="dropdown-menu discount-type-option" aria-labelledby="discount-type">\n                        <li><a class="dropdown-item" data-type="percent" href="#">').concat(__("Discount by %"),'</a></li>\n                        <li><a class="dropdown-item" data-type="value" href="#">').concat(__("Discount by value"),'</a></li>\n                    </ul>\n                </div>\n                <div class="ms-2 d-inline-block" data-type="key-number" >\n                    <input type="text" autocomplete="off" maxlength="3" class="discount-percent-inp form-control form-control-sm text-end ').concat(parseFloat(i.discount_value)>0?"d-none":"",'" value="').concat(i.discount_percent,'" style="max-width:50px;">\n                    <input type="text" autocomplete="off" class="discount-value-inp ').concat(parseFloat(i.discount_value)>0?"":"d-none",' form-control form-control-sm text-end" value="').concat(i.discount_value,'" style="max-width:120px;">\n                </div>\n            </div>'),parseInt(i.discount_percent)>0&&parseInt(i.discount_percent)>0&&parseInt(i.discount_percent)<=100&&(i.discount_total=f(parseInt(i.discount_percent)*i.total)/100,a-=i.discount_total),parseFloat(i.discount_value)>0&&parseFloat(i.discount_value)>0&&(a-=i.discount_value),"1"==k._this.state.settings.fee_calc){i.fee_total=f(k._this.state.settings.fee_percent*a)/100,i.fee_percent=f(k._this.state.settings.fee_percent);var l='<div class="mb-2 mt-2 order-total-fee order-row text-right elipsized">\n                    <b>'.concat(__(k._this.state.settings.fee_display),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(y(k._this,i.fee_total),"</div>\n                 </div>");e+=l,document.querySelector(".order-total-fee")&&(document.querySelector(".order-total-fee").outerHTML=l),a+=i.fee_total}if("1"==k._this.state.settings.tax_calc){i.tax_total=f(a*parseFloat(k._this.state.settings.tax_percent)/100),i.tax_percent=f(k._this.state.settings.tax_percent);var m='<div class="mb-2 mt-2 order-total-tax order-row text-right elipsized">\n                    <b>'.concat(k._this.state.settings.tax_display,'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(y(k._this,i.tax_total),"</div>\n                 </div>");e+=m,document.querySelector(".order-total-tax")&&(document.querySelector(".order-total-tax").outerHTML=m),a+=i.tax_total}i.grand_total=f(a);var v='<div class="mb-2 mt-2 order-total-grandtotal order-row text-right elipsized">\n                <b>'.concat(r("Grand Total"),'</b><div class="ms-2 d-inline-block" data-type="key-number" >').concat(y(k._this,i.grand_total),"</div>\n             </div>");e+=v,document.querySelector(".order-total-grandtotal")&&(document.querySelector(".order-total-grandtotal").outerHTML=v),document.querySelector(".order-total")?document.querySelector(".order-total").dataset.price=encodeURIComponent(JSON.stringify(i)):(document.querySelector(".modal-body-cont").insertAdjacentHTML("beforeend",'<div class="mt-5 order-total order-form text-end" data-type="price" data-price="'.concat(encodeURIComponent(JSON.stringify(i)),'">').concat(e,"</div>")),u(".discount-type-option li a",(function(t){switch(t.preventDefault(),document.querySelector("#discount-type").dataset.type=t.currentTarget.dataset.type,console.log(t.currentTarget.dataset.type),t.currentTarget.dataset.type){case"value":document.querySelector("#discount-type").innerHTML=r("Discount by value"),document.querySelector(".discount-value-inp").style.maxWidth="120px",document.querySelector(".discount-value-inp").classList.remove("d-none"),document.querySelector(".discount-percent-inp").classList.add("d-none"),document.querySelector(".discount-percent-inp").value=0;break;case"percent":document.querySelector("#discount-type").innerHTML=r("Discount by %"),document.querySelector(".discount-percent-inp").style.maxWidth="70px",document.querySelector(".discount-value-inp").classList.add("d-none"),document.querySelector(".discount-percent-inp").classList.remove("d-none"),document.querySelector(".discount-value-inp").value=0}k.refreshTotals()})),g(".discount-percent-inp",[8]),p(".discount-percent-inp",(function(t){parseInt(t.currentTarget.value)>100||parseInt(t.currentTarget.value)<0?t.currentTarget.setCustomValidity("wrong percent value"):t.currentTarget.setCustomValidity(""),t.currentTarget.parentElement.classList.add("was-validated"),t.currentTarget.style.maxWidth="70px",k.refreshTotals()})),g(".discount-value-inp",[8,46]),p(".discount-value-inp",(function(t){parseInt(t.currentTarget.value)<0||parseInt(t.currentTarget.value)>i.total?t.currentTarget.setCustomValidity("wrong discount value"):t.currentTarget.setCustomValidity(""),t.currentTarget.parentElement.classList.add("was-validated"),t.currentTarget.style.maxWidth="120px",k.refreshTotals()})))},addOrderItem:function(t){u(".add-item",(function(e){var a=[],r={};r.id=document.querySelector(".edit-item").dataset.id,r.cats=JSON.parse(document.querySelector(".edit-item").dataset.cats),r.title=document.querySelector(".edit-item").value,r.total=parseFloat(document.querySelector(".edit-tp").value),r.price=parseInt(document.querySelector(".edit-tp").dataset.price),r.qty=parseInt(document.querySelector(".edit-qty").value),r.note="",r.created=k.state.orderSingle.updated,r.variations=[];var s,o=0,i=n(document.querySelectorAll(".item-vars-input input"));try{for(i.s();!(s=i.n()).done;){var d=s.value,c=o;d.checked&&(r.variations[c]||(r.variations[c]={}),r.variations[c].list||(r.variations[c].list={}),r.variations[c].title||(r.variations[c].title=d.dataset.titlev),r.variations[c].list["_"+d.dataset.index]={title:d.dataset.title,price:parseFloat(d.dataset.price)},r.total+=r.qty*parseFloat(d.dataset.price),o+=1)}}catch(t){i.e(t)}finally{i.f()}if(r.title.length<2)alert(__("Incorrect product data"));else{a.push(r);var l=k.structOrderItemTable(t,0,a,!0);document.querySelector(".new-item-row").insertAdjacentHTML("beforebegin",l),k.tableOrderItemListeners(),k.refreshTotals(),document.querySelector(".edit-item").value="",document.querySelector(".edit-tp").value="",document.querySelector(".edit-qty").value="",document.querySelector(".item-vars-input").innerHTML="",setTimeout((function(){document.querySelector(".edit-item").focus()}),300)}}))}},L=function(t,e){var a=e,n={},r=new Date;n.debug=!1,n.print=t.state.settings.receipt_template,n.print=n.print.replace(/{{order_id}}/g,a.id),n.print=n.print.replace(/{{order_table}}/g,a.table?a.table:""),n.print=n.print.replace(/{{date_time}}/g,r.toLocaleString([],{dateStyle:"medium",timeStyle:"short"})),n.print=n.print.replace(/{{order_items}}/g,C(t,a,""));var s=n.print.matchAll(/{{order_items:(.*?):start}}/g);Array.from(s,(function(t){return t[1]})).forEach((function(e){var r=C(t,a,e),s="{{order_items:"+e+"}}",o=new RegExp(s,"g");if(n.print=n.print.replace(o,r),r.length<2){console.log("removing entire block");var i=n.print.indexOf("{{order_items:"+e+":start}}"),d=n.print.indexOf("{{order_items:"+e+":end}}")+("{{order_items:"+e+":end}}").length;n.print=n.print.slice(0,i)+n.print.slice(d)}else s="\n{{order_items:"+e+":start}}",o=new RegExp(s,"g"),n.print=n.print.replace(o,""),s="\n{{order_items:"+e+":end}}",o=new RegExp(s,"g"),n.print=n.print.replace(o,"")}));var o=a.note&&"<br>"!=a.note?a.note:"";o.length>0&&(n.print=n.print.replace(/{{order_note}}/g,"[C]================================\n"+o+"\n[C]================================\n")),n.print=n.print.replace(/{{total}}/g,y(t,a.price.total)),n.print=n.print.replace(/{{tax_total}}/g,y(t,a.price.tax_total)),n.print=n.print.replace(/{{discount_total}}/g,y(t,a.price.discount_total)),n.print=n.print.replace(/{{grand_total}}/g,y(t,a.price.grand_total));var i="";i+="[L]Subtotal[R]"+y(t,a.price.total)+"\n",a.price.discount_total>0&&(i+="[L]"+__("Discount")+"[R]-"+y(t,a.price.discount_total)+"\n"),a.price.fee_total>0&&(i+="[L]"+t.state.settings.fee_display+"[R]"+y(t,a.price.fee_total)+"\n"),a.price.tax_total>0&&(i+="[L]"+t.state.settings.tax_display+"[R]"+y(t,a.price.tax_total)+"\n"),a.price.grand_total>0&&(i+="[L]"+__("Grand Total")+"[R]"+y(t,a.price.grand_total)),n.print=n.print.replace(/{{order_totals}}/g,i),n.print=n.print.replace(/{{qr_link}}/g,"http://"+t.state.qr_settings.slug+".kenzap.site"),n.print=n.print.replace(/{{qr_number}}/g,document.querySelector("#qr-number").value);var d="kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(n));return console.log(n.print),n.debug&&(console.log(n.print),console.log(d)),d},T=function(t,e){for(var a="",n=32-e,r=0,s=0,o=0,i=0;i<Math.ceil(t.length/n);i++){i>0&&(a+="\n[L]"),s=o=0;for(var d=4;d>-4;d--)if(" "==t[o=(n+r)*i+n+d]||o==t.length){s+=d;break}if(a+=t.substr((n+r)*i,n+s),o==t.length)break;r=s}return a},C=function(t,e,a){var n="";for(var r in e.items)if(e.items[r].cats.includes(a)||!(a.length>0)){var s=y(t,e.items[r].total),o=(e.items[r].qty+"").length+(s+"").length+3;for(var i in n+="[L]<b>".concat(e.items[r].qty," X ").concat(T(__(e.items[r].title),o),"</b>[R]").concat(s,"\n"),e.items[r].variations){for(var d in n+="[L] ".concat(T(__(e.items[r].variations[i].title),1),":"),e.items[r].variations[i].list)n+=" ".concat(e.items[r].variations[i].list[d].title,",");n.endsWith(",")&&(n=n.substring(0,n.length-1)+"\n")}}return n.endsWith("\n")&&(n=n.substring(0,n.length-2)),n},M={state:{firstLoad:!0,modalCont:null,modalOpen:!1,playSound:{allowed:!1,ids:null,nids:[],n:0,max_times:5,timer:null,audio:new Audio("https://kenzap.com/static/swiftly.mp3")},orderIDs:[],printLink:null,orders:[],settings:{},qr_settings:{},orderSingle:[],updates:{last_order_id:"",last_order_update:0},playTitleTimer:null,refreshTimer:null,statuses:[],limit:200,slistLimit:10,productsSuggestions:[]},init:function(){M.getData();var t=function(t){M.state.firstLoad&&(M.state.updates.last_order_id=t.last_order_id,M.state.updates.last_order_update=t.last_order_update),t.last_order_update!=M.state.updates.last_order_update&&(S(M,1),M.getData(),M.state.updates.last_order_id=t.last_order_id,M.state.updates.last_order_update=t.last_order_update)};M.state.refreshTimer=setInterval((function(){!function(t,e,a){fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:c,body:JSON.stringify({query:{updates:{type:"updates",source:e}}})}).then((function(t){return t.json()})).then((function(e){e.success&&(a(e),x(t,e.messages))})).catch((function(t){}))}(M,["messages","last_order_id"],t)}),5e3)},getData:function(){M.state.firstLoad&&(()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")})(),M.state.printLink&&(window.location.href=M.state.printLink,M.state.printLink=null);var t=document.querySelector(".search-input")?document.querySelector(".search-input").value:"",e=document.querySelector("#order-status")?document.querySelector("#order-status").dataset.value:"";document.querySelector("body.modal-open")||fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:c,body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar"],token:d("kenzap_token")},locale:{type:"locale",source:["extension"],key:"ecommerce"},orders:{type:"find",key:"ecommerce-order",fields:"*",term:""!=e?"status='"+e+"'":"",limit:M.state.limit,search:{field:"from",s:t},sortby:{field:"created",order:"DESC"}},qr_settings:{type:"get",key:"qrmenu-settings",fields:["slug"]},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_percent_auto","tax_percent","tax_display","fee_calc","fee_percent","fee_display","receipt_template","payment_methods","custom_payment_method","tables","table_list","qr_print","qr_template"]}}})}).then((function(t){return t.json()})).then((function(t){s(),t.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(t),M.loadPageStructure(),M.renderPage(t),M.initListeners(),M.initFooter(),M.state.firstLoad=!1):l(t)})).catch((function(t){l(t)}))},authUser:function(t){t.user&&t.user.success},loadPageStructure:function(){M.state.firstLoad&&(document.querySelector("#contents").innerHTML='\n      <div class="container ec-orders">\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n            <nav class="bc" aria-label="breadcrumb"></nav>\n            <button class="btn btn-primary add-order btn-add mt-3 mb-1 mt-md-0 mb-md-0" type="button">'.concat(r("New order"),'</button>\n        </div>\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n          <div>\n            <div class="col-md-12 page-title">\n              <div class="st-opts st-table dropdown">\n                  <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="order-status" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                    ').concat(r("All"),'\n                  </a>\n                  <ul class="dropdown-menu" aria-labelledby="order-status">\n                    <li><a class="dppi dropdown-item" data-key="" href="#" >').concat(r("All"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="new" href="#" >').concat(r("New"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="paid" href="#" >').concat(r("Paid"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="processing" href="#" >').concat(r("Processing"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="completed" href="#" >').concat(r("Completed"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="canceled" href="#" >').concat(r("Canceled"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="failed" href="#" >').concat(r("Failed"),'</a></li>\n                    <li><a class="dppi dropdown-item" data-key="refunded" href="#" >').concat(r("Refunded"),'</a></li>\n                  </ul>\n              </div>\n              <div class="st-opts" >\n                <div class="input-group-sm mb-0 justify-content-start mb-sm-0" >\n                  <input id="usearch" type="text" class="inp form-control search-input" autocomplete="off" placeholder="').concat(r("Search order"),'">\n                </div>\n                \x3c!-- <a id="viewSum" href="#" style="margin-left:16px;">view summary</a> --\x3e\n              </div>\n            </div>\n          </div>\n          <div class="qr-print-cnt d-none align-self-center my-3 my-md-0">\n            <div class="d-inline-block">\n              <input id="qr-number" type="text" class="inp form-control form-control-sm qr-number p-0 px-2 me-2 ms-0" autocomplete="off" style="max-width:100px;" placeholder="').concat(__("QR number"),'">\n            </div>\n            <div class="d-inline-block">\n              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-qr-code-scan print-qr po" viewBox="0 0 16 16">\n                <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"/>\n                <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"/>\n                <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"/>\n                <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"/>\n                <path d="M12 9h2V8h-2v1Z"/>\n              </svg>\n            </div>\n          </div> \n        </div>\n\n        <div id="orders-after-header">\n\n\n        </div>\n\n        <div class="row">\n          <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n            <div class="card border-white shadow-sm border-0">\n              <div class="card-body p-0">\n \n                <div class="table-responsive">\n                  <table class="table table-hover table-borderless align-middle table-striped table-p-list mb-0">\n                    <thead>\n                      <tr>\n                        <th><span class="ps-1">').concat(r("From"),'</span></th>\n                        <th class="d-none d-sm-table-cell">').concat(r("Status"),"</th>\n                        <th>").concat(r("Subtotal"),'</th>\n                        <th class="d-none d-sm-table-cell">').concat(r("Time"),'</th>\n                        <th></th>\n                      </tr>\n                    </thead>\n                    <tbody class="list">\n\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="modal order-modal" tabindex="-1" data-backdrop="static" data-keyboard="false">\n        <div class="modal-dialog ">\n          <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title"></h5>\n                <button type="button" class="btn-close align-self-start-remove" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body">\n              \n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-primary btn-confirm"></button>\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n              </div>\n          </div>\n        </div>\n      </div>\n\n    '))},renderPage:function(t){if(M.state.firstLoad&&((t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let a of t)void 0===a.link?e+=`<li class="breadcrumb-item">${a.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:o("https://dashboard.kenzap.cloud"),text:r("Dashboard")},{link:o("/"),text:r("E-commerce")},{text:r("Orders")}]),M.state.statuses={new:{text:r("New"),class:"btn-warning text-dark fw-light"},paid:{text:r("Paid"),class:"btn-primary fw-light"},processing:{text:r("Processing"),class:"btn-primary fw-light"},completed:{text:r("Completed"),class:"btn-success fw-light"},canceled:{text:r("Canceled"),class:"btn-secondary fw-light"},failed:{text:r("Failed"),class:"btn-danger fw-light"},refunded:{text:r("Refunded"),class:"btn-danger fw-light"}}),M.state.orders=t.orders,M.state.meta=t.meta,M.state.settings=t.settings,M.state.qr_settings=t.qr_settings,"1"==M.state.settings.qr_print&&document.querySelector(".qr-print-cnt").classList.remove("d-none"),0!=t.orders.length){var e=[];M.state.newOrderCount=[];var a="",n="";for(var s in t.orders){e.push(t.orders[s]._id),void 0===t.orders[s].status&&(t.orders[s].status="new"),"new"==t.orders[s].status&&(n+=t.orders[s].id);var i=M.state.orderIDs.includes(t.orders[s]._id)||M.state.firstLoad?"":"new";a+='\n            <tr class="'.concat(i,'">\n              <td class="details view-order" data-id="').concat(t.orders[s]._id,'" data-index="').concat(s,'">\n                <div class="ps-1" >\n                  <b class="">').concat(t.orders[s].id,"</b> ").concat(t.orders[s].from,'\n                  <div class=" elipsized fst-italic">').concat(t.orders[s].note?t.orders[s].note:"",'</div>\n                  <div class=" d-sm-none"> <span class="me-2">').concat(M.getStatus(t.orders[s].status),'</span> <span class="text-muted">').concat(b(__,t.meta.time,t.orders[s].created),'</span> </div>\n                </div>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span class="fs-12">').concat(M.getStatus(t.orders[s].status),'</span>\n              </td>\n              <td>\n                <span style="font-size:18px;">').concat(y(M,t.orders[s].total),'</span>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span style="font-size:18px;">').concat(b(__,t.meta.time,t.orders[s].created),'</span>\n              </td>\n              <td class="last">\n                <a href="#" data-id="').concat(t.orders[s]._id,'" data-index="').concat(s,'" class="view-order text-success d-none me-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>\n                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>\n                </svg></a>\n                <a href="kenzapprint://kenzapprint.app?data=').concat(encodeURIComponent(JSON.stringify({print:'[C]<u><font size="big">ORDER{{order_id_short}}</font></u>\n[C]Fu Zhen Seafood\n[C]<u type=double>{{date_time}}</u>\n[C]\n[C]================================" \n[L]\n[L]<b>BEAUTIFUL SHIRT</b>[R]9.99\n[L]  + Size : S\n[L]\n[L]<b>AWESOME HAT</b>[R]24.99\n[L]  + Size : 57/58\n[L]\n[C]--------------------------------\n[R]TOTAL PRICE :[R]34.98\n[R]TAX :[R]4.23'})),'" data-id="').concat(t.orders[s]._id,'" data-index="').concat(s,'" class="print-order-dis d-none text-success me-2">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>\n                </svg></a>\n                <a href="#" data-id="').concat(t.orders[s]._id,'" data-index="').concat(s,'" class="remove-order text-danger me-2"><svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n                </svg></a>\n              </td>\n            </tr>')}M.state.playSound.ids&&M.state.playSound.ids!=n&&M.state.playSound.ids.length<n.length&&S(M,3),M.state.playSound.ids=n,M.state.orderIDs=e,document.querySelector(".table tbody").innerHTML=a}else document.querySelector(".table tbody").innerHTML='<tr><td colspan="5">'.concat(r("No orders to display."),"</td></tr>")},getStatus:function(t){return'<div class="badge '.concat(M.state.statuses[t].class,'">').concat(M.state.statuses[t].text,"</div>")},initListeners:function(){q.render(M),k.viewOrder(M),u(".remove-order",M.listeners.removeOrder),u(".st-table li a",M.listeners.changeStatus),M.state.firstLoad&&(k.newOrder(M),u(".modal .btn-primary",M.listeners.modalSuccessBtn),p(".search-input",M.listeners.searchOrders),u(".print-qr",M.listeners.printQR),document.body.addEventListener("touchstart",(function(){M.state.playSound.allowed=!0}),!1),document.body.addEventListener("mousedown",(function(){M.state.playSound.allowed=!0}),!1),window.addEventListener("hashchange",(function(t){if(M.modalCont)return t.preventDefault(),M.modalOpen=!1,M.modalCont.hide(),!1})))},listeners:{newOrder:function(t){},changeStatus:function(t){t.preventDefault();var e=document.querySelector("#order-status");""==t.currentTarget.dataset.key?(e.innerHTML=r("All"),e.dataset.value=""):(e.innerHTML=M.state.statuses[t.currentTarget.dataset.key].text,e.dataset.value=t.currentTarget.dataset.key);Object.keys(M.state.statuses).forEach((function(t){M.state.statuses[t].class.split(" ").forEach((function(t){e.classList.remove(t)})),e.classList.remove("btn-outline-secondary")})),""==t.currentTarget.dataset.key?e.classList.add("btn-outline-secondary"):M.state.statuses[t.currentTarget.dataset.key].class.split(" ").forEach((function(t){e.classList.add(t)})),M.getData()},removeOrder:function(t){t.preventDefault(),confirm(__("Completely remove this order?"))&&fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:c,body:JSON.stringify({query:{product:{type:"delete-order",id:t.currentTarget.dataset.id,sid:i()}}})}).then((function(t){return t.json()})).then((function(t){t.success?M.getData():l(t)})).catch((function(t){l(t)}))},searchOrders:function(t){t.preventDefault(),M.getData()},printQR:function(t){t.preventDefault();var e=function(t,e){var a={debug:!1};a.print=t.state.settings.qr_template,a.print=a.print.replace(/{{qr_link}}/g,"http://"+t.state.qr_settings.slug+".kenzap.site"),a.print=a.print.replace(/{{qr_number}}/g,document.querySelector("#qr-number").value),a.debug&&(console.log(a.print),console.log(n));var n="kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(a));return n}(M);window.location.href=e},modalSuccessBtn:function(t){M.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},updateOrder:function(t,e){var a=document.querySelector(".modal");if("true"!==a.querySelector(".btn-confirm").dataset.loading){a.querySelector(".btn-confirm").dataset.loading=!0,a.querySelector(".btn-confirm").innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+r("Loading..");var s,o={},d=n(document.querySelectorAll(".order-form"));try{for(d.s();!(s=d.n()).done;){var u=s.value;switch(u.dataset.type){case"key":o[u.dataset.id]=u.dataset.value;break;case"key-number":o[u.dataset.id]=f(u.dataset.value);break;case"items":o.items=[];var p,m=n(document.querySelectorAll(".order-item-row-active"));try{for(m.s();!(p=m.n()).done;){var y=p.value,g=JSON.parse(w(y.dataset.vars)),b=JSON.parse(w(y.dataset.cats));o.items.push({id:y.dataset.id,qty:parseInt(y.querySelector(".item-qty").dataset.value),cats:b||[],note:y.querySelector(".item-note").innerHTML,type:"new",index:"0",price:parseFloat(y.querySelector(".item-total").dataset.price),sdesc:y.querySelector(".item-title").dataset.sdesc,title:y.querySelector(".item-title").dataset.value,total:parseFloat(y.querySelector(".item-total").dataset.value),variations:"new"==e?[]:g||[]})}}catch(t){m.e(t)}finally{m.f()}break;case"text":o[u.dataset.id]=u.innerHTML;break;case"email":case"emails":case"select":case"textarea":o[u.id]=u.value;break;case"radio":o[u.id]=u.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector("input:checked").value;break;case"price":o.price=JSON.parse(decodeURIComponent(u.dataset.price)),o.total=o.price.total,o.total_all=o.price.grand_total,document.querySelector(".payment-method-select")&&(o.price.payment_method=document.querySelector(".payment-method-select").value)}}}catch(t){d.e(t)}finally{d.f()}var _=new Date;o.created_ymd=_.getUTCFullYear()+""+h(_.getUTCMonth()+1)+h(_.getUTCDate()),o.created_ym=_.getUTCFullYear()+""+h(_.getUTCMonth()+1),o.created_y=_.getUTCFullYear()+"",o.printed=!!M.state.printLink,"new"==e?(o.name=o.from,o.customer={first_name:o.from,last_name:"",kid:0},fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:c,body:JSON.stringify({query:{order:{type:"create-order",key:"ecommerce-order",data:o}}})}).then((function(t){return t.json()})).then((function(t){t.success?(M.modalCont.hide(),v(__("Order created")),M.state.printLink&&(M.state.printLink=L(M,o)),M.getData()):l(t)})).catch((function(t){l(t)}))):fetch("https://api-v1.kenzap.cloud/ecommerce/",{method:"post",headers:c,body:JSON.stringify({query:{order:{type:"update-order",id:e,sid:i(),data:o}}})}).then((function(t){return t.json()})).then((function(t){t.success?(M.modalCont.hide(),v(__("Order updated")),M.state.printLink&&(M.state.printLink=L(M,o)),M.getData()):l(t)})).catch((function(t){l(t)}))}},initFooter:function(){var t,e;t=__("Created by %1$Kenzap%2$.  Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),e="",document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${t}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${e}</span>\n    </div>`}};M.init()}();
